<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <meta name="renderer" content="webkit">
  <meta name="author" content="leslie">
  <title>小米科技有限责任公司公司企业图谱-企查查</title>
  <meta name="keywords" content="小米科技有限责任公司,小米科技有限责任公司企业图谱,小米科技有限责任公司企业对外投资,小米科技有限责任公司怎么样,小米科技有限责任公司信用图谱">
  <meta name="description" content="小米科技有限责任公司对外投资图谱,发现小米科技有限责任公司的隐藏关联">
  <link rel="icon" href="/material/theme/chacha/cms/v2/images/favicon.png">
  <link rel="stylesheet" href="/material/theme/chacha/cms/v2/css/bootstrap.css" type="text/css"/>
  <link rel="stylesheet" href="/material/theme/chacha/cms/v2/css/font-awesome.min.css" type="text/css"/>
  <link rel="stylesheet" href="/material/theme/chacha/cms/v2/css/icon.css" type="text/css"/>
  <link rel="stylesheet" href="/material/theme/chacha/cms/v2/css/font.css" type="text/css"/>
  <link rel="stylesheet" href="/material/theme/chacha/cms/v2/css/app.css?time=1561053264" type="text/css"/>
  <link rel="stylesheet" href="/material/theme/chacha/cms/v2/css/common.css?time=1561053264" type="text/css"/>
  <link rel="stylesheet" href="/material/theme/chacha/cms/pro/css/simple-line-icons.css" type="text/css"/>
  <!--[if lt IE 9]>
  <link rel="stylesheet" href="/material/theme/chacha/cms/v2/css/app_ie8.css?time=1508428800" type="text/css"/>
  <script src="/material/theme/chacha/cms/v2/js/html5shiv.js"></script>
  <script src="/material/theme/chacha/cms/v2/js/respond.js"></script>
  <![endif]-->
  <script type="text/javascript" src="/material/js/siteconfig.js?time=1561053264"></script>
  <script src="/material/theme/chacha/cms/v2/js/jquery.min.js"></script>
  <script type="text/javascript" src="/material/theme/chacha/cms/v2/js/qrcode.min.js"></script>
  <script type="text/javascript" src="/material/theme/chacha/cms/v2/js/jquery.scrollTo.js"></script>
  <script type="text/javascript" src="/material/theme/chacha/cms/v2/js/jquery.qrcode.min.js"></script>
  <script src="/material/theme/chacha/cms/v2/js/bootstrap.js"></script>
  <script type="text/javascript" src="/material/js/echarts.min.js"></script>
  <script type="text/javascript" src="/material/theme/chacha/cms/v2/js/china.js?time=1508428800"></script>
  <script type="text/javascript" src="/material/theme/chacha/cms/v2/js/chartsUtil.js?time=1561053264"></script>
  <script type="text/javascript" src="/material/theme/chacha/cms/v2/js/kslide.js?time=1561053264"></script>
  <script type="text/javascript" src="/material/theme/chacha/cms/v2/js/searchList.js?time=1561053264"></script>
  <script type="text/javascript" src="/material/theme/chacha/cms/v2/js/phoneSelect.js?time=1561053264"></script>
  <script src="/material/theme/chacha/cms/v2/js/slimscroll/jquery.slimscroll.min.js"></script>
  <link rel="stylesheet" href="/material/theme/chacha/cms/v2/css/toastr.css?time=1561053264"/>
  <script type="text/javascript" src="/material/theme/chacha/cms/v2/js/moment.js"></script>
  <script src="/material/theme/chacha/cms/v2/js/toastr.js" type="text/javascript"></script>
  <script src="/material/theme/chacha/cms/v2/js/custom.js?time=1561053264"></script>
  <script type="text/javascript" src="/material/theme/chacha/cms/v2/js/zhuge.js?time=1561053264"></script>
  <script type="text/javascript">
    var zhugeIdentify = {
      name: '企鹅rqisps',
      groupid: '11',
      client_type: '0',
      mobile: '18012920403',
      email: '',
      regist_time: '2019-06-21 11:09:31'
    };
    var vipStartTime = '0';
    if (vipStartTime) {
      zhugeIdentify.vip_start_time = '';
    }
    window.zhuge.identify('dd4e30f52043d9572827d3d8413ae323', zhugeIdentify);
    var userId = 'dd4e30f52043d9572827d3d8413ae323';
    var userGroupid = '11';
    var freeCompanies = ["19e04b5660c60f271e8e9ebcab490faf", "84a3f1dc246131bd0410a1fd9d384460", "a58533710987ecf98159545b61505a74", "5e0f1e8b864ffbffd3b78eea10961487", "127fcf53de2598be86ab1b3cad165cf1", "9a3c22dfce58dfd8090d59451971229c", "e3e9456716828b1582b34ec25f7dd2e7", "9cce0780ab7644008b73bc2120479d31", "10f538f5dca9fde373612ff44d231d20", "7d294eaabd0bb9b1f316026d4856b41a", "2b6d4910b7514255bb43c36c170e48e3", "815c4b7bca5e74db130b992ea2bc1b88", "bc740f75e5e9b948151f5c608f33030c", "a6dc74fe485c730bc0c71f84ddb4e3a6", "669b7e5de0c437f21b10ddc4d70f4360", "59a1bc8739127dff9ea7e58a8280c4ae", "e45ee37279ffb3f2ce9bbbcfa39d8133", "d2f8562b4fc953539f8e926b8f3f2f08", "18ff2c7ad1d11bfe40e0bec84f6d04d3", "d2240852e88060480af46821b63b7cef", "c9a132f0702d1d7fcb4895673a55f426", "84c17a005a759a5e0d875c1ebb6c9846", "90d3ff3169f1200ef62d78034df9c54e", "7bd0ef47b296f6dd1ea330751bf56612", "cfe8879a8664ad3a373a103e9b5cc526", "c466efe219db3b178390a9185745dda9", "7f996a54c80c8e32636fbf6524571167", "c70a55cb048c8e4db7bca357a2c113e0", "b70a10f461272c5b5ed3d2b8d2b03f69", "a74fc07ca4735f8d8bdd3fbee0c6f6c0", "fab96b719ef6387bd9d095bec03de3f0", "9cce0780ab7644008b73bc2120479d31"];
    var freePeople = ["p347ca283005d596e26b5705fe3e5424", "p25fe19b03899303d307235eaa471916", "pr51b8951f1049973a8ba758266b6779", "p871b2ad73b8b07e3997b0db7fcf9772", "p9fa343b3bb5216b246c72aeb77bce0c", "p67d2355b8ca06b442eda7b5a55b4803", "p226df53c2baa849d6934a9089085ebf", "pc0afc496a38fb16121ba654241bee5b", "pc4a47cfe2e67199a3c45d9f8c40e1c0", "p593208d3aa8e49707325de214a8cb60", "p557b82fef8b08e481aadb65085b008b", "p04609ece9fe504be41433742c1bf3eb", "p522e021cee9336bfb6097250baa3e1b", "p568dbf4e82ed6effd2ea1682c7943b8", "p089070bd9e914e774ef3e95d00ec5b0", "p3483c261f318de061fb3ded0508bf90", "p82222ef85bfd379a8e5226dadc543dd", "p684b3f0c79b5dfe6d8a290ba66e798a", "pc4eb763297cf4b8076c2e0d2fe64617", "p287aa836f4e2c3c6597d09f37731f85", "p858a1f2f2e7864fac8d3acce4c8bb8f", "p8cb6c16db2ea8fac8ecaadefe35ff8b", "p6b2cf613dd4772da8ff3a9575eec8bf", "p0b1f20c4c28963ace6eff596cbb7214", "pfd208a680dc4871736b7001274ba8f0", "pdd3325c48473fcd64180921d82ead80", "pbbefb7a246f4e86a033713e889f9674", "pe366442cb673caf54889e6df853e0c0", "pf6ea929da129db627bfcf9bf48edc65", "p1856f2582e91cf6869be9652cf91512", "pde0ba11f9cc81e8e22b89d378dd597b", "pc127c37072772dabd4865bd62459891", "pe919b2bf2e9c6cdd24d8b63f5969fdd", "p1db0b9e274d3e70dd9a2334ad82b93b", "p38b6a9f4201932948f613f90ab24cdd", "p0e6f9e9a26a0e41c4a3f9be7c062ef2", "p9070853c3d33d38134c64a156989284", "pbccd0d3eb5ada9952e52772f9e54ebe", "p79bb7b0dd3f36e6e5f5100c4e3235a9", "pr9c47cb6b2a96048c1d49d1ec72b3c7", "p89c2161a36e89cd81bc47424c28ae5b", "pae9614885f6fe1df986a5657337915a", "pd24f0e6c29ec7afe56cac57d665a70b", "p32d88b0b48cd2bbcd9d4f29b1b1670d", "p7b171afb629657b151c43bf3e718155", "p375870fa646d110dde4fbe356f1913e", "p0d43bf24ced3d482947792b410b3892", "p2766646c26fb8bf53f01c17c0cd1a7e", "peabcad582bff5cc35feddb8a2dca458", "p9e7818eb8ffc10380ddeb37549c3594", "p62f5e7603c2870f0316e439db89d33e", "p8bb365678cceb173c3f6645fac32463", "pd7d02c68b11c928bc5c5f3f68a43bd8", "pd99973e6e867199057f35891f10ece9", "p5bc1e3c3f62ed3437786bc969600b9a", "pdc2b7a3cc2c414b3910a1d9e116567a", "pa884808a0e7526dd17a682739cb38ec", "p0b093ef01998ca26f345d4231003a9b", "p6abbf243fc5557f96d4488fde8a89f5", "pa85a527d51f75da260083b1cf98da24", "p24129f60d16a9d20e70f29452341dec", "p202afa75ec282beabae2dd5d1f8e521", "p507f1693d86036364ec3b5b4d3c0639", "p60d00d52bf712741e2fc7f435a31302", "p4609f5b766b75d4ab09180fa954da02", "p6da28fd74891226f20838f3900fad36", "pa43fd5c3172044465f25069df6e61b8", "pbfd190fa68be5988ff53ae9c1fb75e7", "p189c9b0f7e004118b9484f47e6cda68", "pcbfd37ad2a2598da9a6b5de289835dd", "p96fe6a8b395b31912ecb7e1f41f23b0", "pea5ac417585edc0effd7d23406510da", "pd57e12ca20e0096dfea61993dfe48f8", "p03cf330a686332cfe9cb8f36a8f3ab8", "p8ca4283fb80cf988920545e99aef3a4", "p1910534b4ae98fea35ddbeb1d61cd44", "pf3b1bf00922bac873eec7950cecec88", "pb5d99e1912cf2b87f96c7fdaa129ebe", "pb6f2f51a297e57acd8a8a161a6a28bc", "peff4efbd8aaa94d852a42d6bd4f622e", "p131e16ad01343fa580933ad37cd33cb", "p70e7789ba2d4e8172cc4fec474711fb", "p6609596e149d5bc0201a0b9f4e4fcb7", "pb7beff14c56b6f216f92ad95d874f51", "pad06603add12c231e78caab20a05f6c", "p411cb5d3d6a3399aa210df8845090ea", "pf614487a898ad76c39ec0fc65ec3d4f", "p954d6bbb51b05a8b3f91e51e79901a9", "p5b288352cf3b9499b9271bf888008df", "p0ca25440e7114c5974d01d583e52b00", "pc747a2d6aaa24efad55793147bc7987", "p2a2c9a1417dfff19e607aa3b30787b9", "p44cb4832f4146f286a2c5c4ab4ef673", "p7cb6f77da9f15766cb65765761c9d19", "p38bfd08992f02ba2a136ca892d62899", "pd05b697b081dcb4e66719032c2cc760", "p61fbfc3a108d8efaf565de1306e23a0", "p21c63257afca04e61ff32ac5580572a", "p1ec3c35fa9051d8723047b80453ae69", "p9d9efeb5aa665dbe66525ced8158f90", "pb0489d8530decee9a061f3be5732844", "p4bcf05c17b1b0918890fe3a5e64d41f", "pfa52806be628929568e0dcbd943d57e", "p18da2d9c2244c6dba4180f0d38a7716", "p30833a0589ab2f56f93bd113bbaf9bd", "pdd9194581da5dda4f700baebc44cc31", "pf21af25ef345c47daa9e738732edfa6", "pe553922ca919d6a7258c4056e2ab6b7", "p7737993e45432ed0e721b28267e058a", "p6fb279283ceeba19fe9e85acf4c1f7e", "p784a2184d94be1818b6d522b5c8a9d9", "pd9751940a8bdcf373ae27804f29c12a", "pa313dc90dffce21f98187ca8b1eaa15", "p8c945c9f031c2fa391208aeb9a63777", "pf1e6aed975eb577cb46d51ac7ec3f14", "p91f92d0f783be4faba5935904f6e2e1", "pb85b223185323f8cc668b7146ddaba9", "p4b2c9d74f0a53dc7834fb9aaed58bfd", "p84c368f313b4d0808e3fb8ca36e10ad", "p917b446e33f719e683fa127465c03bc", "p14811e6d3e3c6380ce34dc64d6bb0c2", "p325ad0d3c574b124e802f3ad612b7bd", "pb46f67ed928d48c6f59af057ca64fcf", "pc5e58ea25a0966d860efa862e64a4b3", "p0cf2da4ed6ccd9fff31cd232bd3a795", "p2bf510b2944458716d0a263913866f1", "p2bfa369c340fc42e4c408a98f0a1f26", "p4f92d97100bd868d73fa62e9ce00b28", "p592a5a06fd6d1ffa4a204e0c499de24", "pa289f26dbfa128c37beb57b793edc79", "pf410cc5e6bf73d7a117de49a7b1af5e", "p2c045fc38d5bec1d438cc581e0f86a4", "p89043bad02f62e899855bceb1f7c71b", "pr4c963d26e89c8fff17daf449668e16", "p8cf7445cd8c5956c7480f1d507b2cd1", "p885609c358d14e07fd99d41ed314e99", "p57180cc2a70271694f52740d0d9ae1b", "p4a6bb86866883881d5f7005f861f7a4", "p57153b6ab8750d1dfd32b0c56f398d1", "p556225ea3e000a06e4a35f2bdf18481", "p1c907e22aaff36740ea8f603b901b32", "p412cd235e5252a1c8b90705bf19fbcb", "p0b9468faca13fb6100df091d20297f1", "pb4e17e90f7c1cfa54560ac4fe041db6", "p6c7313d1a025112e8778dfeedc0ffe1", "pc491219acf1f61a59c04dea39bedfa5", "p5bb4cb536f8904b937650ecbac0b94a", "p26b2932ed1a63519bb81e44ba8c104c", "pd3f1646db9a01cea29c61c33b9ee617", "p64df099fa4661b4d400c5896a39681b", "pd923a5cc21dfac7fdbf9dfa9c6fa533", "pc97d58fb9ac9bd3836bbe07fdd2735a", "p0248c4f7a28bc236748fc4610b5ef1d", "p4caa8eb789c5d0fe7d6a88b0dc9000c", "p4f2b6e1ae6b40edafecde1c73e85cd2", "pad4ad4c3b995c633a39ae06c899f18a", "p056aab2e73f92dbcebd51da8111c1ac", "pr894be363cef980d10af39d88a85398", "p0794177a7df688a3c779b7408edebf0", "pf9ec94f17dc07af1ecd3409f3523f6d", "pbb6cbd616af10953b12db428bd7af9d", "p7e22dafa4d6ee1193820480fed43953", "p067936c7397b739ec6b0d297b95ec06", "pr0a8298f7c230bf5fc40124625a7d1c", "p8718f47f94756d94d3933ea806b76c3", "p418e3e56998a8e8237a551840a9976d", "pd260c6712ed49ee88504a64c5ed9482", "pa8379689f22cb9c588dadacbac3bd90", "p3a8634f7b3ad183f6f31b9123868dce", "pr796baa55fffb4891c66c5cadf93242", "p686bfc2eccc4011491c9a1ddbc7609e", "p1b1e565d80a051007b8d18f17e07e05", "p9a719fb3a18f289340fd0c43c356839", "p91e374fa50b4648e9911d941ece2b82", "p824b008f59b9e5d89842ea9bd529587", "pff44c7629a4b0a2bf96eea21a63f1f7", "p3fb6d0bed1bd2c96b172f77c97846f4", "p1fdaf8e212811fb8edd33781d84b24d", "p4150ff74059ca6c582cb6151ff9718b", "p10ff32f62339a56dee86d3a362ee8b2", "pf28d61dd4cd96570757734940a28c55", "pr0ac1235cf5613a979f9c28dc920302", "p436160a297843d6312902a0049665d1", "p196fb6607ce39e7e2156b254a9e54d0", "p283698248c8c18693974f0ed8e2c488", "p1910534b4ae98fea35ddbeb1d61cd44"];
  </script>
  <script type="text/javascript">
    var qrcodePolling = false;
  </script>
</head>
<body>
<header class="header navi-header box-shadow ">
  <div class="container ">
    <div class="navi-brand"><a onclick="zhugeTrack('主页-顶部-logo');" href="/"> <img src="/material/theme/chacha/cms/v2/images/logo4.png" class="m-r-sm" alt="企查查"> </a></div>
    <form class="navi-form" role="search" action="
                /search">
      <div class="form-group">
        <div class="input-group"><a id="clearSearchkey" class="clear-searchkey"></a> <input id="headerKey" name="key" class="form-control headerKey" style="font-size: 14px;"
                                                                                            type="text" placeholder="请输入企业名称、人名，产品名等，多关键词用空格隔开，如“小米 雷军”" value=""
                                                                                            autocomplete="off"> <span class="input-group-btn" style="float: left"> <button
                onclick="" type="submit" class="btn btn-primary top-searchbtn"></button> </span></div>
      </div>
      <section class="panel headerKey header-section" id="header-search-list"></section>
    </form>
    <script type="text/javascript">
      $('#headerKey').searchList({
        list: '#header-search-list',
        clear: '#clearSearchkey',
      });
    </script>
    <script type="text/javascript">
      var pathname_ = window.location.pathname;
      if (pathname_ == '/search_riskinfo' || pathname_ == '/search_intellectualinfo') {
        $('#tpsearch').attr('action', pathname_);
      }
    </script>
    <ul class="navi-nav pull-right">
      <li class="" class="dropdown"><a onclick="zhugeTrack('主页-顶部-APP下载');" href="/app" class="dropdown-toggle header-qrcode">
        APP下载
      </a>
        <section class="dropdown-menu qrcode-box"><img src="/material/theme/chacha/cms/v2/images/header_qrcode@2x.png?t=3"></section>
      </li>
      <li class="head-line">|</li>
      <li class="">
      <li class=""><a onclick="zhugeTrack('主页-顶部-开通VIP');" href="/vip">开通VIP</a></li>
      </li>
      <li class="head-line">|</li>
      <li class=""><a onclick="zhugeTrack('主页-顶部-企业套餐');" href="/qiye">企业套餐</a></li>
      <li class="head-line">|</li>
      <li class="dropdown msg-drop"><a onclick="" href="/msg"> <img src="/material/theme/chacha/cms/v2/images/ic_noti.png" alt="消息中心"> </a>
        <section class="dropdown-menu msg-box">
          <ul class="list-group m-b-none">
            <li class="list-group-item">
              <div class="he">消息中心（ <span class="text-danger unreadmsgnum">0</span> 条未读）</div>
            </li>
            <li class="list-group-item">
              <div class="pnodata"><img src="/material/theme/chacha/cms/v2/images/nno_image.png">
                <p>暂无消息</p></div>
            </li>
          </ul>
        </section>
      </li>
      <li class="dropdown user-drop"><a style="padding-left: 5px;" onclick="zhugeTrack('主页-顶部-个人账号');" href="/user_setting"> <span class="headface"> <img
              src=" https://co-image.qichacha.com/upload/face/72.jpg " alt="个人中心" onerror="this.src='/material/theme/chacha/cms/v2/images/icon_user2_default@2x.png'"> </span>
        企鹅rqis…


        <b class="caret"></b> </a>
        <ul class="dropdown-menu nav-user">
          <li><a onclick="" href="/radar"> 雷达监控</a></li>
          <li><a onclick="" href="/user_company"> 我的公司</a></li>
          <li class="divider"></li>
          <li><a onclick="" href="/balance_manage"> 我的账户</a></li>
          <li><a onclick="" href="/user_credit"> 我的积分</a></li>
          <li><a onclick="" href="/user_qa"> 我的问答<span class="icon-new"></span></a></li>
          <li><a onclick="" href="/order_manage"> 我的订单</a></li>
          <li><a onclick="" href="/user_follow"> 我的关注</a></li>
          <li><a onclick="" href="/user_download"> 我的导出</a></li>
          <li><a onclick="" href="/user_note"> 我的笔记</a></li>
          <li><a onclick="" href="/user_setting"> 账号设置</a></li>
          <li><a onclick="" href="/user_visit"> 访问记录</a></li>
          <li class="divider"></li>
          <li><a onclick="" href="/user_logout"> 退出登录</a></li>
        </ul>
      </li>
    </ul>
  </div>
</header>
<script type="text/javascript" src="/material/js/jquery.cookie.js"></script>
<script type="text/javascript" src="/material/js/jquery.validate.min.js"></script>
<script type="text/javascript" src="/material/js/jquery.form.min.js"></script>
<script type="text/javascript" src="/material/js/global.js?t=1561053264"></script>
<link rel="stylesheet" href="/material/theme/chacha/cms/v2/css/companyDetail.css?time=1561106524" type="text/css"/>
<style type="text/css">
  html, body {
    height: 100%;
    background-color: #fff;
  }

  .node {
    cursor: pointer;
  }

  .node:hover circle {
    transform: scale(1.2);
  }

  .node:hover text {
    color: #000 !important;
    font-weight: bold !important;
    font-size: 15px !important;
  }

  .bsBox, .bsBox * {
    box-sizing: content-box;
  }

  .invest-node, .hoper-node, .stock-node, .employ-node, .branch-node, .hstock-node {
    cursor: pointer;
  }

  .water-mark {
    position: absolute;
    z-index: 15;
    font-size: 12px;
    color: #aaa;
    text-align: center;
    width: 100%;
    bottom: 20px;
  }

</style>
<div class="mao-loading" id="load_data"><img src="/material/theme/chacha/cms/v2/images/preloader.gif"></div>
<div class="mao-nodata" id="no_data">
  <div class="guquan-lnodata pnodata"><img src="/material/theme/chacha/cms/v2/images/nno_image.png">
    <p>没有找到相关数据</p></div>
</div>
<div class="mao-head whitebg">
  <div class="container">
    <ul class="mao-title breadcrumb" style="background:none;border:none;">
      <li><a href="/firm_9cce0780ab7644008b73bc2120479d31.html"> <img src="/material/theme/chacha/cms/v2/images/ic_reply.png"> <a class="text-primary"
                                                                                                                                  href="/firm_9cce0780ab7644008b73bc2120479d31.html">
        小米科技有限责任公司
      </a> </a></li>
    </ul>
    <ul id="navTab" class="mao-nav">
      <li class="active"><a onclick="" href="/company_businessmap?keyNo=9cce0780ab7644008b73bc2120479d31&name=小米科技有限责任公司">企业图谱</a></li>
      <li class=""><a onclick="" href="/company_muhou3?keyNo=9cce0780ab7644008b73bc2120479d31&name=小米科技有限责任公司">关联图谱</a></li>
      <li class=""><a onclick="" href="/company_guquan?keyNo=9cce0780ab7644008b73bc2120479d31&name=小米科技有限责任公司">股权穿透图</a></li>
      <li class=""><a onclick="zhugeTrack('图谱页面-疑似实际控制人')" href="/company_kzr?keyNo=9cce0780ab7644008b73bc2120479d31&name=小米科技有限责任公司">疑似实际控制人</a> <span class="ntag vip m-l-sm"
                                                                                                                                                        data-trigger="hover"
                                                                                                                                                        data-html="true"
                                                                                                                                                        data-toggle="tooltip"
                                                                                                                                                        data-placement="bottom"
                                                                                                                                                        data-delay="500"
                                                                                                                                                        title="尊敬的会员，您正在使用高级特权">功能</span>
      </li>
    </ul>
  </div>
</div>
<div class="mao-screen-area" id="screenArea">
  <div id="main" class="mao-main tupu-shuiying2">
    <svg xmlns="http://www.w3.org/2000/svg"></svg>
  </div>
  <div class="water-mark">企业图谱由企查查基于公开信息利用大数据分析引擎独家生成。</div>
  <div class="tupu-toolbar">
    <ul>
      <li onclick="maoScale(1)"><span class="big"></span>放大</li>
      <li onclick="maoScale(2)"><span class="small"></span>缩小</li>
      <li onclick="maoRefresh()"><span class="refresh"></span>刷新</li>
      <li onclick="changeScreen(this)"><span class="screen"></span>全屏</li>
      <li onclick="saveImg();zhugeTrack('图谱-保存',{'图谱类型':'企业图谱'});"><span class="save"></span>保存</li>
    </ul>
  </div>
  <div id="company-detail" class="company-detail tp-detail">
    <div class="e_close-bar"><span class="ea_title">公司信息</span> <span class="ea_close" onclick="popclose(this)">&times;</span></div>
    <div class="detail-content-wrap">
      <div class="e_pop-detail-top">
        <div class="ea_left"><img class="mao-img" onerror="this.src='/material/theme/chacha/cms/v2/images/default_face.png'"
                                  src="/material/theme/chacha/cms/v2/images/default_face.png"></div>
        <div class="ea_right">
          <div class="ea_row1"><a target="_blank" class="ea_name-com mao-company-name">-</a></div>
          <div class="ea_row2"><span class="text-gray">法定代表人：</span><a class="mao-oper">-</a></div>
          <div class="ea_row2"><span class="text-gray">注册资本：</span><span class="text-black mao-ziben">-</span></div>
          <div class="ea_row2"><span class="text-gray">成立日期：</span><span class="text-black mao-date">-</span></div>
        </div>
      </div>
      <div class="m-t"><a class="btn mao-tupu-link" target="_blank">查看图谱</a></div>
      <div class="m-t mao-content m-b-lg">
        <ul class="nav nav-tabs mao-tabs">
          <li class="active"><a href="#gudong" aria-controls="gudong" role="tab" data-toggle="tab">股东</a></li>
          <li><a href="#touzi" aria-controls="touzi" role="tab" data-toggle="tab">对外投资</a></li>
          <li><a href="#member" aria-controls="member" role="tab" data-toggle="tab">主要成员</a></li>
        </ul>
        <div class="tab-content mao-tab-content">
          <div role="tabpanel" class="gudong-list tab-pane fade in active" id="gudong"></div>
          <div role="tabpanel" class="touzi-list tab-pane fade" id="touzi"></div>
          <div role="tabpanel" class="member-list tab-pane fade" id="member"></div>
        </div>
      </div>
    </div>
  </div>
  <div id="person-detail" class="company-detail tp-detail">
    <div class="e_close-bar"><span class="ea_title">人员信息</span> <span class="ea_close" onclick="popclose(this)">&times;</span></div>
    <div class="detail-content-wrap">
      <div class="e_pop-detail-top">
        <div class="ea_left"><img id="face_oss" onerror="personImgErr()" alt="">
          <div class="ea_defaultImg"></div>
        </div>
        <div class="ea_right">
          <div class="ea_row1"><a class="ea_name">-</a><a class="text-warning allRrelative" target="_blank">他关联<span class="relativeInfoCount">0</span>家企业></a></div>
          <div class="ea_row2"><span class="text-gray">企业：</span><a id="PerCom" class="text-blue" target="_blank">-</a></div>
          <div class="ea_row2"><span class="text-gray">职位：</span><span id="PerJob" class="text-black">-</span></div>
        </div>
      </div>
      <div class="m-t"><a id="ShowPerTupuA" class="btn mao-tupu-link" target="_blank">查看图谱</a></div>
      <div id="NameBar">简介</div>
    </div>
  </div>
</div>
<script src="/material/theme/chacha/cms/v2/js/d3.v5.min.js"></script>
<script type="text/javascript">


  var width = $('#main').width();
  var height = $('#main').height() - 40;

  var svg;
  var container;
  var zoom;
  var branchNodes = [];
  var branchLinks = [];
  var branchExtend = false;

  var investNodes = [];
  var investLinks = [];
  var investExtend = false;

  var hoperNodes = [];
  var hoperLinks = [];
  var hoperExtend = false;

  var hstockNodes = [];
  var hstockLinks = [];
  var hstockExtend = false;

  var employNodes = [];
  var employLinks = [];
  var employExtend = false;

  var stockNodes = [];
  var stockLinks = [];
  var stockExtend = false;


  var translateX = 0;
  var translateY = 0;
  var scale = 1;

  var centerPointX;
  var centerPointY;
  var gMinY = 0;
  var gMaxY = 0;

  var offsetWidth = 100;

  var _currentKeyNo;
  var isIE = (!!window.ActiveXObject || "ActiveXObject" in window);

  if (isIE) {
    //location.href=INDEX_URL+'company_businessmap2?keyNo=9cce0780ab7644008b73bc2120479d31&name=%E5%B0%8F%E7%B1%B3%E7%A7%91%E6%8A%80%E6%9C%89%E9%99%90%E8%B4%A3%E4%BB%BB%E5%85%AC%E5%8F%B8';
  }

  $(document).ready(function () {
    resizeScreen();
    getData();


  });

  window.onresize = function () {
    resizeScreen();
  }

  function changeScreen(dom) {

    if (!isFullScreen()) {
      $(dom).html('<span class="screened"></span>退出');
      launchFullScreen($('#screenArea')[0]);
    } else {
      $(dom).html('<span class="screen"></span>全屏');
      exitFullScreen();
    }
  }

  //切换全屏
  setFullScreenListener(function () {
    setTimeout(function () {
      //zoom.translateTo(svg,svg.attr('width')/2,svg.attr('height')/2);
    }, 300);
  })//

  function maoScale(type) {
    if (type == 1) {
      scale += 0.2;
    } else if (type == 2) {
      scale -= 0.2;
    }
    if (scale < 0.4) {
      scale = 0.4;
    }
    if (scale > 2) {
      scale = 2;
    }
    zoom.scaleTo(svg, scale);
  }

  function maoRotate(type) {


  }

  function maoRefresh() {

    investExtend = true;
    hoperExtend = true;
    hstockExtend = true;
    employExtend = true;
    stockExtend = true;
    zoom.translateTo(svg, svg.attr('width') / 2, svg.attr('height') / 2);
    zoom.scaleTo(svg, 1);
    draw();
  }

  function saveImg() {
    jietu('main');
  }


  function jietu(svgDivId) {
    var jietuMask = document.createElement("div");
    $(jietuMask).attr('style', 'position: fixed; background: #fff; z-index: 1000; top: 0px; bottom: 0px; left: 0px; right: 0px;');
    document.body.appendChild(jietuMask);

    var _transform = d3.zoomTransform(svg.node());
    var _svgWidth = d3.select('svg').attr('width');
    var _svgHeight = d3.select('svg').attr('height');

    var gWidth = container._groups[0][0].getBoundingClientRect().width / scale * 1.2;
    var gHeight = container._groups[0][0].getBoundingClientRect().height / scale * 1.2;

    var targetWidth = gWidth + 600;
    var targetHeight = gHeight + 600;

    if (branchExtend || investExtend || hoperExtend || hstockExtend || employExtend || stockExtend) {
      d3.select('svg').attr('width', targetWidth);
      d3.select('svg').attr('height', targetHeight);

      zoom.scaleTo(svg, 1.2);
      zoom.translateTo(svg, 0 + centerPointX, 0 + centerPointY);

      if (Math.abs(gMinY + gMaxY) > 200) {
        zoom.translateBy(svg, 0, -(gMinY + gMaxY) / 2 - 80);
      } else {
        zoom.translateBy(svg, 0, -80);
      }
    }


    var svgXml = $('#' + svgDivId).html();
    var image = new Image();
    image.src = 'data:image/svg+xml;base64,' + window.btoa(unescape(encodeURIComponent(svgXml)));

    setTimeout(function () {
      zoom.transform(svg, _transform);
      var canvas = document.createElement('canvas');  //准备空画布
      canvas.width = d3.select('svg').attr('width');
      canvas.height = d3.select('svg').attr('height');
      d3.select('svg').attr('width', _svgWidth);
      d3.select('svg').attr('height', _svgHeight);
      $(jietuMask).css('display', 'none');
      var context = canvas.getContext('2d');  //取得画布的2d绘图上下文
      context.fillStyle = "#fff";
      context.fillRect(0, 0, canvas.width, canvas.height);

      var shuiying = new Image();
      shuiying.src = "/material/theme/chacha/cms/v2/images/shuiying2.png";
      for (var i = 0; i < canvas.width + 100; i += 600) {
        for (var j = 0; j < canvas.height + 100; j += 456) {
          context.drawImage(shuiying, i, j);
        }
      }

      context.drawImage(image, 0, 0);
      var marker = '企业图谱由企查查基于公开信息利用大数据分析引擎独家生成。';
      context.font = "18px 微软雅黑";
      context.fillStyle = "#aaaaaa";
      context.fillText(marker, canvas.width / 2 - context.measureText(marker).width / 2, canvas.height - 30);
      downloadimg(canvas);
    }, 100);
  }

  function getData() {
    $('#load_data').show();
    var url = INDEX_URL + "cms_companypicmap";
    $.ajax({
      url: url,
      type: 'GET',
      data: {
        keyNo: getQueryString("keyNo"),
      },
      dataType: 'JSON',
      success: function (data) {
        $('#load_data').hide();
        if (data) {
          $('#no_data').hide();
          root = data;
          branchNodes = data.Branches || [];
          investNodes = data.EquityShareDetail || [];
          hoperNodes = data.HistoryOpers || [];
          hstockNodes = data.HistoryPartners || [];
          employNodes = data.Employees || [];
          stockNodes = data.partners || [];
          initNodes();
          draw();
        } else {
          $('#no_data').show();
          $('#screenArea').hide();
        }
      }
    });
  }

  function initNodes() {
    var startX = width / 2;
    var startY = height / 2;

    var name = root.Name;
    var lines = Math.ceil(name.length / 20);
    var blockWidth = 280;
    if (lines < 2) {
      blockWidth = 32 + getLength(name) * 6;
      offsetWidth = (blockWidth - 80) / 2;
    }

    for (var i = 0; i < branchNodes.length; i++) {
      branchNodes[i].x = startX + 220 + offsetWidth;
      branchNodes[i].y = startY - 14 + i * 38;

      branchLinks.push({
        source: {x: branchNodes[i].x - 25, y: branchNodes[i].y + 14},
        target: {x: branchNodes[i].x, y: branchNodes[i].y + 14}
      });

      if (branchNodes[i].y - startY > gMaxY) {
        gMaxY = branchNodes[i].y - startY;
      }
    }
    if (branchNodes.length > 0) {
      branchLinks.push({
        source: {x: startX + 170 + offsetWidth, y: startY},
        target: {x: startX + 195 + offsetWidth, y: startY}
      });
      branchLinks.push({
        source: {x: startX + 195 + offsetWidth, y: startY},
        target: {x: startX + 195 + offsetWidth, y: branchNodes[branchNodes.length - 1].y + 14}
      });
    }


    for (var i = 0; i < investNodes.length; i++) {
      investNodes[i].x = startX + 220 + offsetWidth;
      investNodes[i].y = startY - 85 - i * 38;

      var min = investNodes[i].y;
      if (min < translateY) {
        translateY = min;
      }

      investLinks.push({
        source: {x: investNodes[i].x - 25, y: investNodes[i].y + 14},
        target: {x: investNodes[i].x, y: investNodes[i].y + 14}
      });
      if (investNodes[i].y - startY < gMinY) {
        gMinY = investNodes[i].y - startY;
      }
    }
    if (investNodes.length > 0) {
      investLinks.push({
        source: {x: startX + 170 + offsetWidth, y: startY - 71},
        target: {x: startX + 195 + offsetWidth, y: startY - 71}
      });
      investLinks.push({
        source: {x: startX + 195 + offsetWidth, y: startY - 71},
        target: {x: startX + 195 + offsetWidth, y: investNodes[investNodes.length - 1].y + 14}
      });
    }

    var hperY = 0;
    for (var i = 0; i < hoperNodes.length; i++) {
      hoperNodes[i].x = startX + 100 + offsetWidth;

      if (i == 0) {
        hoperNodes[i].y = startY + 90;
      } else {
        var lines = Math.ceil(hoperNodes[i - 1].OperName.length / 6);
        hperY += 22 + 16 * lines;
        hoperNodes[i].y = startY + 90 + hperY;
      }


      hoperLinks.push({
        source: {x: hoperNodes[i].x - 20, y: hoperNodes[i].y + 14},
        target: {x: hoperNodes[i].x, y: hoperNodes[i].y + 14}
      });

      if (hoperNodes[i].y - startY > gMaxY) {
        gMaxY = hoperNodes[i].y - startY;
      }
    }
    if (hoperNodes.length > 0) {
      hoperLinks.push({
        source: {x: startX + 80 + offsetWidth, y: startY + 80},
        target: {x: startX + 80 + offsetWidth, y: hoperNodes[hoperNodes.length - 1].y + 14}
      });
    }

    var hstockY = 0;
    for (var i = 0; i < hstockNodes.length; i++) {
      hstockNodes[i].x = startX - 150 - offsetWidth;

      if (i == 0) {
        hstockNodes[i].y = startY + 90;
      } else {
        var lines = Math.ceil(hstockNodes[i - 1].PartnerName.length / 16);
        hstockY += 22 + 16 * lines;
        hstockNodes[i].y = startY + 90 + hstockY;
      }

      hstockLinks.push({
        source: {x: hstockNodes[i].x - 20, y: hstockNodes[i].y + 14},
        target: {x: hstockNodes[i].x, y: hstockNodes[i].y + 14}
      });

      if (hstockNodes[i].y - startY > gMaxY) {
        gMaxY = hstockNodes[i].y - startY;
      }
    }
    if (hstockNodes.length > 0) {
      hstockLinks.push({
        source: {x: startX - 170 - offsetWidth, y: startY + 80},
        target: {x: startX - 170 - offsetWidth, y: hstockNodes[hstockNodes.length - 1].y + 14}
      });
    }


    for (var i = 0; i < employNodes.length; i++) {
      employNodes[i].x = startX - 220 - offsetWidth;
      employNodes[i].y = startY - 14 + i * 38;

      var minX = translateX;
      if (employNodes[i].Name) {
        if (employNodes[i].Job) {
          minX = employNodes[i].x - 40 - employNodes[i].Name.length * 12 - employNodes[i].Job.length * 12
        } else {
          minX = employNodes[i].x - 30 - employNodes[i].Name.length * 12;
        }
      } else {
        minx = employNodes[i].x - 90;
      }

      if (minX < translateX) {
        translateX = minX;
      }

      employLinks.push({
        source: {x: employNodes[i].x + 25, y: employNodes[i].y + 14},
        target: {x: employNodes[i].x, y: employNodes[i].y + 14}
      });

      if (employNodes[i].y - startY > gMaxY) {
        gMaxY = employNodes[i].y - startY;
      }
    }
    if (employNodes.length > 0) {
      employLinks.push({
        source: {x: startX - 170 - offsetWidth, y: startY},
        target: {x: startX - 195 - offsetWidth, y: startY}
      });
      employLinks.push({
        source: {x: startX - 195 - offsetWidth, y: startY},
        target: {x: startX - 195 - offsetWidth, y: employNodes[employNodes.length - 1].y + 14}
      });
    }

    for (var i = 0; i < stockNodes.length; i++) {
      stockNodes[i].x = startX - 220 - offsetWidth;
      stockNodes[i].y = startY - 85 - i * 38;

      var minX = translateX;
      if (stockNodes[i].StockName) {
        if (stockNodes[i].StockPercent) {
          minX = stockNodes[i].x - 40 - stockNodes[i].StockName.length * 12 - stockNodes[i].StockPercent.length * 12
        } else {
          minX = stockNodes[i].x - 30 - stockNodes[i].StockName.length * 12;
        }
      } else {
        minx = stockNodes[i].x - 90;
      }

      if (minX < translateX) {
        translateX = minX;
      }


      var min = stockNodes[i].y;
      if (min < translateY) {
        translateY = min;
      }

      stockLinks.push({
        source: {x: stockNodes[i].x + 25, y: stockNodes[i].y + 14},
        target: {x: stockNodes[i].x, y: stockNodes[i].y + 14}
      });

      if (stockNodes[i].y - startY < gMinY) {
        gMinY = stockNodes[i].y - startY;
      }
    }
    if (stockNodes.length > 0) {
      stockLinks.push({
        source: {x: startX - 170 - offsetWidth, y: startY - 71},
        target: {x: startX - 195 - offsetWidth, y: startY - 71}
      });
      stockLinks.push({
        source: {x: startX - 195 - offsetWidth, y: startY - 71},
        target: {x: startX - 195 - offsetWidth, y: stockNodes[stockNodes.length - 1].y + 14}
      });
    }
  }

  function draw() {
    svg = d3.select("svg");

    zoom = d3.zoom()
        .scaleExtent([0.4, 2])
        .on("zoom", zoomed);

    $("svg").empty();
    svg.attr("width", width);
    svg.attr("height", height);

    svg.attr("width", width)
        .attr("height", height)
        .style("fill", "none")
        .style("pointer-events", "all")
        .on("click", function () {
          $(".title").css("display", "none");
        })
        .call(zoom);

    container = svg.append("g");


    drawRoot();

    drawArrow();

    drawButton();

    drawBranches();

    drawInvest();

    drawHoper();

    drawHstock();

    drawEmploy();

    drawStock();

    function zoomed() {
      scale = d3.event.transform.k;
      container.attr("transform", d3.event.transform);
    }
  }

  function drawRoot() {
    var g = container.append("g");
    var name = root.Name;
    var lines = Math.ceil(name.length / 20);
    var blockWidth = 280;
    if (lines < 2) {
      blockWidth = 32 + getLength(name) * 6;
      offsetWidth = (blockWidth - 80) / 2;
    }
    var blockHeight = lines * 15 + 20;
    g.append("rect")
        .style("fill", "#128bed")
        .transition()
        .duration(500)
        .attr("width", blockWidth)
        .attr("height", blockHeight)
        .style("opacity", 0.73)
        .attr("rx", 4)
        .attr("ry", 4);

    for (var i = 0; i < lines; i++) {
      g.append("text")
          .attr("x", 10)
          .attr("y", 20 + 15 * i)
          .text(name.substr(i * 20, 20))
          .style("fill", "#ffffff")
          .style("font-size", "13px");
    }
    centerPointX = width / 2 - blockWidth / 2;
    centerPointY = height / 2 - blockHeight / 2;
    g.attr("transform", "translate(" + (centerPointX) + ",+" + (centerPointY) + ")");
  }

  function drawArrow() {
    var branchArrow = container.append("g");
    branchArrow.append("polygon")
        .attr("points", "0,0 15,0 15,-4.25 20.5,1 15,6.25 15,2 0,2")
        .style("fill", "#128bed")
        .style("opacity", 0.73)
        .attr("transform", "translate(" + (width / 2 + 50 + offsetWidth) + "," + (height / 2) + ")")

    var employArrow = container.append("g");
    employArrow.append("polygon")
        .attr("points", "0,0 15,0 15,-4.25 20.5,1 15,6.25 15,2 0,2")
        .style("fill", "#128bed")
        .style("opacity", 0.73)
        .attr("transform", "translate(" + (width / 2 - 50 - 20.5 - offsetWidth) + "," + (height / 2) + ")");

    var investArrow = container.append("g");
    investArrow.append("polygon")
        .attr("points", "0,0 15,0 15,-4.25 20.5,1 15,6.25 15,2 0,2")
        .style("fill", "#128bed")
        .style("opacity", 0.73)
        .attr("transform", "translate(" + (width / 2 + 50 + offsetWidth) + "," + (height / 2 - 40) + "),rotate(-30)");

    var hOperArrow = container.append("g");
    hOperArrow.append("polygon")
        .attr("points", "0,0 15,0 15,-4.25 20.5,1 15,6.25 15,2 0,2")
        .style("fill", "#128bed")
        .style("opacity", 0.73)
        .attr("transform", "translate(" + (width / 2 + 68 + offsetWidth) + "," + (height / 2 + 50) + "),rotate(-150)");

    var stockArrow = container.append("g");
    stockArrow.append("polygon")
        .attr("points", "0,0 15,0 15,-4.25 20.5,1 15,6.25 15,2 0,2")
        .style("fill", "#128bed")
        .style("opacity", 0.73)
        .attr("transform", "translate(" + (width / 2 - 50 - 20.5 - offsetWidth) + "," + (height / 2 - 50) + "),rotate(30)");

    var hstockArrow = container.append("g");
    hstockArrow.append("polygon")
        .attr("points", "0,0 15,0 15,-4.25 20.5,1 15,6.25 15,2 0,2")
        .style("fill", "#128bed")
        .style("opacity", 0.73)
        .attr("transform", "translate(" + (width / 2 - 50 - 20.5 - offsetWidth) + "," + (height / 2 + 50) + "),rotate(-30)");
  }

  function drawButton() {
    var branchButton = container.append("g")
        .attr("transform", "translate(" + (width / 2 + 80 + offsetWidth) + "," + (height / 2 - 15.5) + ")")
        .on("click", function () {
          branchExtend = !branchExtend;
          drawBranches();
        });
    branchButton.append("rect")
        .attr("width", 90)
        .attr("height", 33)
        .style("fill", "#EECB5F")
        .style("opacity", 0.2)
        .attr("rx", 4)
        .attr("ry", 4);

    if (branchNodes.length > 0) {
      branchExtend = true;
      branchButton.append("circle")
          .attr("cx", 12)
          .attr("cy", 16)
          .attr("r", 6)
          .attr("fill", "none")
          .attr("stroke", "#666666")
          .attr("stroke-width", "0.5");

      branchButton.append("path")
          .attr("id", "branch-path")
          .attr("d", "M7 15 H17 V17 H7 Z")
          .attr("fill", "#666666");
    }


    branchButton.append("text")
        .attr("x", 25)
        .attr("y", 20)
        .text("分支机构")
        .attr("fill", "#333333")
        .style("font-weight", "bold")
        .style("font-size", "12px");

    var investButton = container.append("g")
        .attr("transform", "translate(" + (width / 2 + 80 + offsetWidth) + "," + (height / 2 - 85) + ")")
        .on("click", function () {
          investExtend = !investExtend;
          drawInvest();
        });
    investButton.append("rect")
        .attr("width", 90)
        .attr("height", 33)
        .style("fill", "#9E77F2")
        .style("opacity", 0.2)
        .attr("rx", 4)
        .attr("ry", 4);

    if (investNodes.length > 0) {
      investExtend = true;
      investButton.append("circle")
          .attr("cx", 12)
          .attr("cy", 16)
          .attr("r", 6)
          .attr("fill", "none")
          .attr("stroke", "#666666")
          .attr("stroke-width", "0.5");

      investButton.append("path")
          .attr("id", "invest-path")
          .attr("d", "M7 15 H11 V11 H13 V15 H17 V17 H13 V21 H11 V17 H7 Z")
          .attr("fill", "#666666");
    }

    investButton.append("text")
        .attr("x", 25)
        .attr("y", 20)
        .text("对外投资")
        .attr("fill", "#333333")
        .style("font-weight", "bold")
        .style("font-size", "12px");

    var hoperButton = container.append("g")
        .attr("transform", "translate(" + (width / 2 + 80 + offsetWidth) + "," + (height / 2 + 50) + ")")
        .on("click", function () {
          hoperExtend = !hoperExtend;
          drawHoper();
        });
    hoperButton.append("rect")
        .attr("width", 90)
        .attr("height", 33)
        .style("fill", "#ED6D5C")
        .style("opacity", 0.2)
        .attr("rx", 4)
        .attr("ry", 4);

    if (hoperNodes.length > 0) {
      hoperExtend = true;
      hoperButton.append("circle")
          .attr("cx", 12)
          .attr("cy", 16)
          .attr("r", 6)
          .attr("fill", "none")
          .attr("stroke", "#666666")
          .attr("stroke-width", "0.5");

      hoperButton.append("path")
          .attr("id", "hoper-path")
          .attr("d", "M7 15 H11 V11 H13 V15 H17 V17 H13 V21 H11 V17 H7 Z")
          .attr("fill", "#666666");
    }

    hoperButton.append("text")
        .attr("x", 25)
        .attr("y", 20)
        .text("历史法人")
        .style("font-weight", "bold")
        .attr("fill", "#333333")
        .style("font-size", "12px");

    var hstockButton = container.append("g")
        .attr("transform", "translate(" + (width / 2 - 170 - offsetWidth) + "," + (height / 2 + 50) + ")")
        .on("click", function () {
          hstockExtend = !hstockExtend;
          drawHstock();
        });
    hstockButton.append("rect")
        .attr("width", 90)
        .attr("height", 33)
        .style("fill", "#ED6D5C")
        .style("opacity", 0.2)
        .attr("rx", 4)
        .attr("ry", 4);

    if (hstockNodes.length > 0) {
      hstockExtend = true;
      hstockButton.append("circle")
          .attr("cx", 12)
          .attr("cy", 16)
          .attr("r", 6)
          .attr("fill", "none")
          .attr("stroke", "#666666")
          .attr("stroke-width", "0.5");

      hstockButton.append("path")
          .attr("id", "hstock-path")
          .attr("d", "M7 15 H11 V11 H13 V15 H17 V17 H13 V21 H11 V17 H7 Z")
          .attr("fill", "#666666");

    }

    hstockButton.append("text")
        .attr("x", 25)
        .attr("y", 20)
        .text("历史股东")
        .attr("fill", "#333333")
        .style("font-weight", "bold")
        .style("font-size", "12px");

    var employButton = container.append("g")
        .attr("transform", "translate(" + (width / 2 - 170 - offsetWidth) + "," + (height / 2 - 15.5) + ")")
        .on("click", function () {
          employExtend = !employExtend;
          drawEmploy();
        });
    employButton.append("rect")
        .attr("width", 90)
        .attr("height", 33)
        .style("fill", "#67AEF5")
        .style("opacity", 0.2)
        .attr("rx", 4)
        .attr("ry", 4);

    if (employNodes.length > 0) {
      employExtend = true;
      employButton.append("circle")
          .attr("cx", 12)
          .attr("cy", 16)
          .attr("r", 6)
          .attr("fill", "none")
          .attr("stroke", "#666666")
          .attr("stroke-width", "0.5");

      employButton.append("path")
          .attr("id", "employ-path")
          .attr("d", "M7 15 H11 V11 H13 V15 H17 V17 H13 V21 H11 V17 H7 Z")
          .attr("fill", "#666666");
    }

    employButton.append("text")
        .attr("x", 25)
        .attr("y", 20)
        .text("高管")
        .attr("fill", "#333333")
        .style("font-weight", "bold")
        .style("font-size", "12px");

    var stockButton = container.append("g")
        .attr("transform", "translate(" + (width / 2 - 170 - offsetWidth) + "," + (height / 2 - 85) + ")")
        .on("click", function () {
          stockExtend = !stockExtend;
          drawStock();
        });
    stockButton.append("rect")
        .attr("width", 90)
        .attr("height", 33)
        .style("fill", "#84DB56")
        .style("opacity", 0.2)
        .attr("rx", 4)
        .attr("ry", 4);

    if (stockNodes.length > 0) {
      stockExtend = true;
      stockButton.append("circle")
          .attr("cx", 12)
          .attr("cy", 16)
          .attr("r", 6)
          .attr("fill", "none")
          .attr("stroke", "#666666")
          .attr("stroke-width", "0.5");

      stockButton.append("path")
          .attr("id", "stock-path")
          .attr("d", "M7 15 H17 V17 H7 Z")
          .attr("fill", "#666666");
    }

    stockButton.append("text")
        .attr("x", 25)
        .attr("y", 20)
        .text("股东")
        .attr("fill", "#333333")
        .style("font-weight", "bold")
        .style("font-size", "12px");
  }

  function drawBranches() {
    var nodes = [];
    var links = [];

    if (branchExtend) {
      nodes = branchNodes;
      links = branchLinks;
      d3.select("#branch-path")
          .attr("d", "M7 15 H17 V17 H7 Z");
    } else {
      nodes = [];
      links = [];
      d3.select("#branch-path")
          .attr("d", "M7 15 H11 V11 H13 V15 H17 V17 H13 V21 H11 V17 H7 Z");

    }

    var branchContainer = container.selectAll(".branch-node").data(nodes);

    var enterNodes = branchContainer.enter();
    var exitNodes = branchContainer.exit();

    var enterNodeContainer = enterNodes.append("g")
        .attr("class", "branch-node")
        .attr("transform", function (d) {
          return "translate(" + (width / 2 + 80 + offsetWidth) + "," + (height / 2 - 15.5) + ")";
        });

    enterNodeContainer.on("click", function (d) {
      if (d.KeyNo) {
        showDetail(d.KeyNo, 'company_businessmap');
      }

    })
    enterNodeContainer.append("rect")
        .attr("width", function (d) {
          if (d.Name) {
            return 30 + getLength(d.Name) * 6;
          }
          return 90;
        })
        .attr("height", 28)
        .style("fill", "#EECB5F")
        .style("opacity", 0)
        .attr("rx", 4)
        .attr("ry", 4);

    enterNodeContainer.append("text")
        .attr("x", 15)
        .attr("y", 18)
        .text(function (d) {
          return d.Name
        })
        .attr("fill", "#333333")
        .style("font-size", "12px")
        .style("opacity", 0);


    var enterNodesTransition = enterNodeContainer.transition()
        .duration(500)
        .attr("transform", function (d) {
          return "translate(" + d.x + "," + d.y + ")";
        });

    enterNodesTransition.select("rect")
        .style("opacity", 0.2);
    enterNodesTransition.select("text")
        .style("opacity", 1);

    var exitNodesTransition = exitNodes.transition()
        .duration(500)
        .attr("transform", function (d) {
          return "translate(" + (width / 2 + 80 + offsetWidth) + "," + (height / 2 - 15.5) + ")";
        })
        .remove();
    exitNodesTransition.select("rect")
        .style("fill-opacity", 0)

    exitNodesTransition.select("text")
        .style("fill-opacity", 0);

    var linksSet = container.selectAll(".branch-link").data(links);
    var enterLinks = linksSet.enter();
    var exitLinks = linksSet.exit();

    enterLinks.append("line")
        .attr("class", "branch-link")
        .attr("x1", function (d) {
          return d.source.x;
        })
        .attr("y1", function (d) {
          return d.source.y
        })
        .attr("x2", function (d) {
          return d.source.x;
        })
        .attr("y2", function (d) {
          return d.source.y
        })
        .transition()
        .duration(500)
        .attr("x2", function (d) {
          return d.target.x;
        })
        .attr("y2", function (d) {
          return d.target.y
        })
        .style("stroke", "#B4B4B4")
        .style("stroke-width", 1);

    exitLinks.transition()
        .duration(500)
        .attr("x1", function (d) {
          return d.source.x;
        })
        .attr("y1", function (d) {
          return d.source.y
        })
        .attr("x2", function (d) {
          return d.source.x;
        })
        .attr("y2", function (d) {
          return d.source.y
        })
        .remove();

  }

  function drawInvest() {
    var nodes = [];
    var links = [];

    if (investExtend) {
      nodes = investNodes;
      links = investLinks;
      d3.select("#invest-path")
          .attr("d", "M7 15 H17 V17 H7 Z");
    } else {
      nodes = [];
      links = [];
      d3.select("#invest-path")
          .attr("d", "M7 15 H11 V11 H13 V15 H17 V17 H13 V21 H11 V17 H7 Z");

    }
    var investContainer = container.selectAll(".invest-node").data(nodes);

    var enterNodes = investContainer.enter();
    var exitNodes = investContainer.exit();

    var enterNodeContainer = enterNodes.append("g")
        .attr("class", "invest-node")
        .attr("transform", function (d) {
          return "translate(" + (width / 2 + 80 + offsetWidth) + "," + (height / 2 - 85) + ")";
        });

    enterNodeContainer.on("click", function (d) {
      if (d.KeyNo) {
        showDetail(d.KeyNo, 'company_businessmap');
      }
    })

    enterNodeContainer.append("rect")
        .attr("width", function (d) {
          if (d.Name) {
            return 30 + getLength(d.Name) * 6;
          }
          return 90;
        })
        .attr("height", 28)
        .style("fill", "#9E77F2")
        .style("opacity", 0)
        .attr("rx", 4)
        .attr("ry", 4);

    enterNodeContainer.append("text")
        .attr("x", 15)
        .attr("y", 18)
        .text(function (d) {
          return d.Name
        })
        .attr("fill", "#333333")
        .style("font-size", "12px")
        .style("opacity", 0);


    var enterNodesTransition = enterNodeContainer.transition()
        .duration(500)
        .attr("transform", function (d) {
          return "translate(" + d.x + "," + d.y + ")";
        });

    enterNodesTransition.select("rect")
        .style("opacity", 0.2);
    enterNodesTransition.select("text")
        .style("opacity", 1);

    var exitNodesTransition = exitNodes.transition()
        .duration(500)
        .attr("transform", function (d) {
          return "translate(" + (width / 2 + 80 + offsetWidth) + "," + (height / 2 - 85) + ")";
        })
        .remove();
    exitNodesTransition.select("rect")
        .style("fill-opacity", 0)

    exitNodesTransition.select("text")
        .style("fill-opacity", 0);

    var linksSet = container.selectAll(".invest-link").data(links);
    var enterLinks = linksSet.enter();
    var exitLinks = linksSet.exit();

    enterLinks.append("line")
        .attr("class", "invest-link")
        .attr("x1", function (d) {
          return d.source.x;
        })
        .attr("y1", function (d) {
          return d.source.y
        })
        .attr("x2", function (d) {
          return d.source.x;
        })
        .attr("y2", function (d) {
          return d.source.y
        })
        .transition()
        .duration(500)
        .attr("x2", function (d) {
          return d.target.x;
        })
        .attr("y2", function (d) {
          return d.target.y
        })
        .style("stroke", "#B4B4B4")
        .style("stroke-width", 1);

    exitLinks.transition()
        .duration(500)
        .attr("x1", function (d) {
          return d.source.x;
        })
        .attr("y1", function (d) {
          return d.source.y
        })
        .attr("x2", function (d) {
          return d.source.x;
        })
        .attr("y2", function (d) {
          return d.source.y
        })
        .remove();

  }

  function drawHoper() {
    var nodes = [];
    var links = [];

    if (hoperExtend) {
      nodes = hoperNodes;
      links = hoperLinks;
      d3.select("#hoper-path")
          .attr("d", "M7 15 H17 V17 H7 Z");
    } else {
      nodes = [];
      links = [];
      d3.select("#hoper-path")
          .attr("d", "M7 15 H11 V11 H13 V15 H17 V17 H13 V21 H11 V17 H7 Z");

    }
    var hoperContainer = container.selectAll(".hoper-node").data(nodes);

    var enterNodes = hoperContainer.enter();
    var exitNodes = hoperContainer.exit();

    var enterNodeContainer = enterNodes.append("g")
        .attr("class", "hoper-node")
        .attr("transform", function (d) {
          return "translate(" + (width / 2 + 80 + offsetWidth) + "," + (height / 2 + 55) + ")";
        });

    enterNodeContainer.on("click", function (d) {
      if (d.KeyNo) {
        showDetail2(d.KeyNo, 'company_muhou4', 'person');
      }
    })

    enterNodeContainer.append("rect")
        .attr("width", function (d) {
          if (d.OperName) {
            if (Math.ceil(d.OperName.length / 6) > 1) {
              return 90;
            } else {
              return 30 + getLength(d.OperName) * 6;
            }
          }
          return 90;
        })
        .attr("height", function (d) {
          if (d.OperName) {
            if (Math.ceil(d.OperName.length / 6) > 1) {
              return 12 + 16 * Math.ceil(d.OperName.length / 6);
            }
          }
          return 28;
        })
        .style("fill", "#ED6D5C")
        .style("opacity", 0)
        .attr("rx", 4)
        .attr("ry", 4);

    enterNodeContainer.each(function (d) {
      for (var i = 0; i < Math.ceil(d.OperName.length / 6); i++) {
        d3.select(this).append("text")
            .text(function (d) {
              return d.OperName.substr(i * 6, 6)
            })
            .attr("x", 15)
            .attr("y", 18 + i * 16)
            .attr("fill", "#333333")
            .style("font-size", "12px")
            .style("opacity", 0);
      }
    })


    var enterNodesTransition = enterNodeContainer.transition()
        .duration(500)
        .attr("transform", function (d) {
          return "translate(" + d.x + "," + d.y + ")";
        });

    enterNodesTransition.select("rect")
        .style("opacity", 0.2);
    enterNodesTransition.selectAll("text")
        .style("opacity", 1);

    var exitNodesTransition = exitNodes.transition()
        .duration(500)
        .attr("transform", function (d) {
          return "translate(" + (width / 2 + 80 + offsetWidth) + "," + (height / 2 + 55) + ")";
        })
        .remove();
    exitNodesTransition.select("rect")
        .style("fill-opacity", 0)

    exitNodesTransition.selectAll("text")
        .style("fill-opacity", 0);

    var linksSet = container.selectAll(".hoper-link").data(links);
    var enterLinks = linksSet.enter();
    var exitLinks = linksSet.exit();

    enterLinks.append("line")
        .attr("class", "hoper-link")
        .attr("x1", function (d) {
          return d.source.x;
        })
        .attr("y1", function (d) {
          return d.source.y
        })
        .attr("x2", function (d) {
          return d.source.x;
        })
        .attr("y2", function (d) {
          return d.source.y
        })
        .transition()
        .duration(500)
        .attr("x2", function (d) {
          return d.target.x;
        })
        .attr("y2", function (d) {
          return d.target.y
        })
        .style("stroke", "#B4B4B4")
        .style("stroke-width", 1);

    exitLinks.transition()
        .duration(500)
        .attr("x1", function (d) {
          return d.source.x;
        })
        .attr("y1", function (d) {
          return d.source.y
        })
        .attr("x2", function (d) {
          return d.source.x;
        })
        .attr("y2", function (d) {
          return d.source.y
        })
        .remove();

  }

  function drawHstock() {
    var nodes = [];
    var links = [];

    if (hstockExtend) {
      nodes = hstockNodes;
      links = hstockLinks;
      d3.select("#hstock-path")
          .attr("d", "M7 15 H17 V17 H7 Z");
    } else {
      nodes = [];
      links = [];
      d3.select("#hstock-path")
          .attr("d", "M7 15 H11 V11 H13 V15 H17 V17 H13 V21 H11 V17 H7 Z");

    }
    var hstockContainer = container.selectAll(".hstock-node").data(nodes);

    var enterNodes = hstockContainer.enter();
    var exitNodes = hstockContainer.exit();

    var enterNodeContainer = enterNodes.append("g")
        .attr("class", "hstock-node")
        .attr("transform", function (d) {
          return "translate(" + (width / 2 - 170 - offsetWidth) + "," + (height / 2 + 55) + ")";
        });

    enterNodeContainer.on("click", function (d) {
      if (d.KeyNo) {
        if (d.Org == 2) {
          showDetail2(d.KeyNo, 'company_muhou4', 'person');
        } else {
          showDetail(d.KeyNo, 'company_businessmap');
        }
      }
    })

    enterNodeContainer.append("rect")
        .attr("width", function (d) {
          if (d.PartnerName) {
            if (Math.ceil(d.PartnerName.length / 16) > 1) {
              return 222;
            }
            return 30 + getLength(d.PartnerName) * 6;
          }
          return 90;
        })
        .attr("height", function (d) {
          if (d.PartnerName) {
            if (Math.ceil(d.PartnerName.length / 16) > 1) {
              return 12 + 16 * Math.ceil(d.PartnerName.length / 16);
            }
          }
          return 28;
        })
        .style("fill", "#ED6D5C")
        .style("opacity", 0)
        .attr("rx", 4)
        .attr("ry", 4);

    enterNodeContainer.each(function (d) {
      for (var i = 0; i < Math.ceil(d.PartnerName.length / 16); i++) {
        d3.select(this).append("text")
            .text(function (d) {
              return d.PartnerName.substr(i * 16, 16)
            })
            .attr("x", 15)
            .attr("y", 18 + i * 16)
            .attr("fill", "#333333")
            .style("font-size", "12px")
            .style("opacity", 0);
      }
    })


    var enterNodesTransition = enterNodeContainer.transition()
        .duration(500)
        .attr("transform", function (d) {
          return "translate(" + d.x + "," + d.y + ")";
        });

    enterNodesTransition.select("rect")
        .style("opacity", 0.2);
    enterNodesTransition.selectAll("text")
        .style("opacity", 1);

    var exitNodesTransition = exitNodes.transition()
        .duration(500)
        .attr("transform", function (d) {
          return "translate(" + (width / 2 - 170 - offsetWidth) + "," + (height / 2 + 55) + ")";
        })
        .remove();
    exitNodesTransition.select("rect")
        .style("fill-opacity", 0)

    exitNodesTransition.selectAll("text")
        .style("fill-opacity", 0);

    var linksSet = container.selectAll(".hstock-link").data(links);
    var enterLinks = linksSet.enter();
    var exitLinks = linksSet.exit();

    enterLinks.append("line")
        .attr("class", "hstock-link")
        .attr("x1", function (d) {
          return d.source.x;
        })
        .attr("y1", function (d) {
          return d.source.y
        })
        .attr("x2", function (d) {
          return d.source.x;
        })
        .attr("y2", function (d) {
          return d.source.y
        })
        .transition()
        .duration(500)
        .attr("x2", function (d) {
          return d.target.x;
        })
        .attr("y2", function (d) {
          return d.target.y
        })
        .style("stroke", "#B4B4B4")
        .style("stroke-width", 1);

    exitLinks.transition()
        .duration(500)
        .attr("x1", function (d) {
          return d.source.x;
        })
        .attr("y1", function (d) {
          return d.source.y
        })
        .attr("x2", function (d) {
          return d.source.x;
        })
        .attr("y2", function (d) {
          return d.source.y
        })
        .remove();
  }

  function drawEmploy() {
    var nodes = [];
    var links = [];

    if (employExtend) {
      nodes = employNodes;
      links = employLinks;
      d3.select("#employ-path")
          .attr("d", "M7 15 H17 V17 H7 Z");
    } else {
      nodes = [];
      links = [];
      d3.select("#employ-path")
          .attr("d", "M7 15 H11 V11 H13 V15 H17 V17 H13 V21 H11 V17 H7 Z");

    }
    var employContainer = container.selectAll(".employ-node").data(nodes);

    var enterNodes = employContainer.enter();
    var exitNodes = employContainer.exit();

    var enterNodeContainer = enterNodes.append("g")
        .attr("class", "employ-node")
        .attr("transform", function (d) {
          return "translate(" + (width / 2 - 170 - offsetWidth) + "," + (height / 2 - 15.5) + ")";
        });

    enterNodeContainer.on("click", function (d) {
      if (d.KeyNo) {
        showDetail2(d.KeyNo, 'company_muhou4', 'person');
      }
    })

    enterNodeContainer.append("rect")
        .attr("width", function (d) {
          if (d.Name) {
            if (d.Job) {
              return 40 + getLength(d.Name) * 6 + getLength(d.Job) * 6
            }
            return 30 + d.Name.length * 12;
          }
          return 90;
        })
        .attr("height", 28)
        .attr("x", function (d) {
          if (d.Name) {
            if (d.Job) {
              return 0 - 40 - getLength(d.Name) * 6 - getLength(d.Job) * 6;
            }
            return 0 - 30 - getLength(d.Name) * 6;
          }
          return -90;
        })
        .style("fill", "#67AEF5")
        .style("opacity", 0)
        .attr("rx", 4)
        .attr("ry", 4);


    if (isIE) {
      enterNodeContainer.append("text")
          .attr("x", function (d) {
            if (d.Name) {
              if (d.Job) {
                return 15 - 40 - getLength(d.Name) * 6 - getLength(d.Job) * 6;
              }
              return 15 - 30 - getLength(d.Name) * 6;
            }
            return -70;
          })
          .attr("y", 18)
          .text(function (d) {
            return d.Name
          })
          .attr("class", "employ-name")
          .attr("fill", "#333333")
          .style("font-size", "12px")
          .style("opacity", 0);
    } else {
      enterNodeContainer.append("text")
          .attr("x", function (d) {
            if (d.Name) {
              if (d.Job) {
                return 15 - 40 - getLength(d.Name) * 6 - getLength(d.Job) * 6;
              }
              return 15 - 30 - getLength(d.Name) * 6;
            }
            return -70;
          })
          .attr("y", 18)
          .html(function (d) {
            return d.Name
          })
          .attr("class", "employ-name")
          .attr("fill", "#333333")
          .style("font-size", "12px")
          .style("opacity", 0);
    }

    enterNodeContainer.append("text")
        .attr("x", function (d) {
          if (d.Name) {
            return 15 - 30 - getLength(d.Job) * 6;
          }
          return -70;
        })
        .attr("y", 18)
        .text(function (d) {
          return d.Job
        })
        .attr("class", "employ-job")
        .attr("fill", "#8a8a8a")
        .style("font-size", "12px")
        .style("opacity", 0);


    var enterNodesTransition = enterNodeContainer.transition()
        .duration(500)
        .attr("transform", function (d) {
          return "translate(" + d.x + "," + d.y + ")";
        });

    enterNodesTransition.select("rect")
        .style("opacity", 0.2);
    enterNodesTransition.select(".employ-name")
        .style("opacity", 1);

    enterNodesTransition.select(".employ-job")
        .style("opacity", 1);

    var exitNodesTransition = exitNodes.transition()
        .duration(500)
        .attr("transform", function (d) {
          return "translate(" + (width / 2 - 170 - offsetWidth) + "," + (height / 2 - 15.5) + ")";
        })
        .remove();
    exitNodesTransition.select("rect")
        .style("fill-opacity", 0)

    exitNodesTransition.select(".employ-name")
        .style("fill-opacity", 0);

    exitNodesTransition.select(".employ-job")
        .style("fill-opacity", 0);

    var linksSet = container.selectAll(".employ-link").data(links);
    var enterLinks = linksSet.enter();
    var exitLinks = linksSet.exit();

    enterLinks.append("line")
        .attr("class", "employ-link")
        .attr("x1", function (d) {
          return d.source.x;
        })
        .attr("y1", function (d) {
          return d.source.y
        })
        .attr("x2", function (d) {
          return d.source.x;
        })
        .attr("y2", function (d) {
          return d.source.y
        })
        .transition()
        .duration(500)
        .attr("x2", function (d) {
          return d.target.x;
        })
        .attr("y2", function (d) {
          return d.target.y
        })
        .style("stroke", "#B4B4B4")
        .style("stroke-width", 1);

    exitLinks.transition()
        .duration(500)
        .attr("x1", function (d) {
          return d.source.x;
        })
        .attr("y1", function (d) {
          return d.source.y
        })
        .attr("x2", function (d) {
          return d.source.x;
        })
        .attr("y2", function (d) {
          return d.source.y
        })
        .remove();
  }

  function drawStock() {
    var nodes = [];
    var links = [];

    if (stockExtend) {
      nodes = stockNodes;
      links = stockLinks;
      d3.select("#stock-path")
          .attr("d", "M7 15 H17 V17 H7 Z");
    } else {
      nodes = [];
      links = [];
      d3.select("#stock-path")
          .attr("d", "M7 15 H11 V11 H13 V15 H17 V17 H13 V21 H11 V17 H7 Z");

    }
    var stockContainer = container.selectAll(".stock-node").data(nodes);

    var enterNodes = stockContainer.enter();
    var exitNodes = stockContainer.exit();

    var enterNodeContainer = enterNodes.append("g")
        .attr("class", "stock-node")
        .attr("transform", function (d) {
          return "translate(" + (width / 2 - 170 - offsetWidth) + "," + (height / 2 - 85) + ")";
        });

    enterNodeContainer.on("click", function (d) {
      if (d.KeyNo) {
        if (d.Org == 2) {
          showDetail2(d.KeyNo, 'company_muhou4', 'person');
        } else {
          showDetail(d.KeyNo, 'company_businessmap');
        }
      }
    })

    enterNodeContainer.append("rect")
        .attr("width", function (d) {
          if (d.StockName) {
            if (d.StockPercent) {
              return 40 + getLength(d.StockName) * 6 + getLength(d.StockPercent) * 6
            }
            return 30 + d.StockName.length * 12;
          }
          return 90;
        })
        .attr("height", 28)
        .attr("x", function (d) {
          if (d.StockName) {
            if (d.StockPercent) {
              return 0 - 40 - getLength(d.StockName) * 6 - getLength(d.StockPercent) * 6
            }
            return 0 - 30 - getLength(d.StockName) * 6;
          }
          return -90;
        })
        .style("fill", "#84DB56")
        .style("opacity", 0)
        .attr("rx", 4)
        .attr("ry", 4);

    enterNodeContainer.append("text")
        .attr("x", function (d) {
          if (d.StockName) {
            if (d.StockPercent) {
              return 15 - 40 - getLength(d.StockName) * 6 - getLength(d.StockPercent) * 6
            }
            return 15 - 30 - getLength(d.StockName) * 6;
          }
          return -70;
        })
        .attr("y", 18)
        .text(function (d) {
          return d.StockName
        })
        .attr("class", "stock-name")
        .attr("fill", "#333333")
        .style("font-size", "12px")
        .style("opacity", 0);

    enterNodeContainer.append("text")
        .attr("x", function (d) {
          if (d.StockName) {
            return 15 - 30 - getLength(d.StockPercent) * 6;
          }
          return -70;
        })
        .attr("y", 18)
        .text(function (d) {
          return d.StockPercent
        })
        .attr("class", "stock-job")
        .attr("fill", "#8a8a8a")
        .style("font-size", "12px")
        .style("opacity", 0);


    var enterNodesTransition = enterNodeContainer.transition()
        .duration(500)
        .attr("transform", function (d) {
          return "translate(" + d.x + "," + d.y + ")";
        });

    enterNodesTransition.select("rect")
        .style("opacity", 0.2);
    enterNodesTransition.select(".stock-name")
        .style("opacity", 1);

    enterNodesTransition.select(".stock-job")
        .style("opacity", 1);

    var exitNodesTransition = exitNodes.transition()
        .duration(500)
        .attr("transform", function (d) {
          return "translate(" + (width / 2 - 170 - offsetWidth) + "," + (height / 2 - 85) + ")";
        })
        .remove();
    exitNodesTransition.select("rect")
        .style("fill-opacity", 0)

    exitNodesTransition.select(".stock-name")
        .style("fill-opacity", 0);

    exitNodesTransition.select(".stock-job")
        .style("fill-opacity", 0);

    var linksSet = container.selectAll(".stock-link").data(links);
    var enterLinks = linksSet.enter();
    var exitLinks = linksSet.exit();

    enterLinks.append("line")
        .attr("class", "stock-link")
        .attr("x1", function (d) {
          return d.source.x;
        })
        .attr("y1", function (d) {
          return d.source.y
        })
        .attr("x2", function (d) {
          return d.source.x;
        })
        .attr("y2", function (d) {
          return d.source.y
        })
        .transition()
        .duration(500)
        .attr("x2", function (d) {
          return d.target.x;
        })
        .attr("y2", function (d) {
          return d.target.y
        })
        .style("stroke", "#B4B4B4")
        .style("stroke-width", 1);

    exitLinks.transition()
        .duration(500)
        .attr("x1", function (d) {
          return d.source.x;
        })
        .attr("y1", function (d) {
          return d.source.y
        })
        .attr("x2", function (d) {
          return d.source.x;
        })
        .attr("y2", function (d) {
          return d.source.y
        })
        .remove();
  }


  function getLength(str) {
    if (str) {
      var hanLength = 0;
      if (/[\u0391-\uFFE5]/i.test(str)) {
        hanLength = str.match(/[\u0391-\uFFE5]/g).length
      }
      var upcaseLength = 0;
      if (/[A-Z]/i.test(str)) {
        upcaseLength = str.match(/[A-Z]/g).length
      }
      return str.length + hanLength + upcaseLength / 3;
    } else {
      return 0;
    }

  }

  function resizeScreen() {
    if (document.body.clientHeight > 700) {
      $('#screenArea').height(document.body.clientHeight - 66);
    } else {
      $('#screenArea').height(640);
    }
  }


  function popclose(dom) {
    $(dom).parent().parent().fadeOut();
  }

  function personImgErr() {
    var name = $(".ea_name").text();
    $('#face_oss').hide();
    $('.ea_defaultImg').show();
    $('.ea_defaultImg').text(name[0]);
  }

  if (window.iframe) {
    $('.navi-header').hide();
    $('.mao-head').hide();
    $('.tupu-toolbar').hide();
    $('.water-mark').css('bottom', '10px');
    timeoutRoam();
  }

  function post(URL, PARAMS) {
    var temp = document.createElement("form");
    temp.action = URL;
    temp.enctype = "multipart/form-data";
    temp.method = "post";
    temp.style.display = "none";
    for (var x in PARAMS) {
      var opt = document.createElement("textarea");
      opt.name = x;
      opt.value = PARAMS[x];
      // alert(opt.name)
      temp.appendChild(opt);
    }
    document.body.appendChild(temp);
    temp.submit();
    return temp;
  }

  function downloadimg(canvas) {
    var qual = 1;
    if (canvas.width > 3000) {
      qual = 0.8;
    } else if (canvas.width > 8000) {
      qual = 0.5;
    }
    //设置保存图片的类型
    var imgdata = canvas.toDataURL('image/jpeg', qual);
    var filename = '小米科技有限责任公司的企业图谱_' + new Date().toLocaleDateString() + '.jpeg';
    post(INDEX_URL + 'cms_downloadimg?filename=' + filename, {img: imgdata});
  }


</script>
<style>
  /*详情弹窗*/
  .company-detail {
    padding: 0px;
    top: 75px;
  }

  .detail-content-wrap {
    padding: 10px 20px;
  }

  .detail-bottom {
    height: 350px;
    overflow-y: auto;
    padding-right: 3px;
  }

  .detail-title-wrap {
    margin-bottom: 10px;
  }

  .detail-title {
    color: #000000;
    font-size: 16px;
    font-weight: 600;
  }

  .detail-count {
    color: #128BED;
    font-size: 16px;
    padding-left: 6px;
  }

  .detail-a, .detail-a:hover {
    color: #128BED;
    font-size: 14px;
  }

  .detail-content {
    border: 1px solid #E4EEF6;
    padding: 12px;
    margin-bottom: 20px;
  }

  #NameBar {
    position: absolute;
    background: white;
    width: 252px;
    height: 30px;
    bottom: 362px; /*bottom:346px;*/
    line-height: 30px;
    z-index: 2;
    font-size: 16px;
    font-weight: 600;
  }

  #NameBar .detail-count {
    font-weight: normal;
  }

  #NameBar .detail-a {
    font-weight: normal;
    margin-right: 10px;
  }

  /**/
  #ScrollContent .detail-title-wrap a.pull-right {
    margin-right: 10px;
  }

  .marginNone {
    margin-bottom: 0px !important;
  }

</style>
<script type="text/template" id="PerDeailTpl">
  <div id="ScrollContent" class="m-t mao-content m-b-lg detail-bottom">
    <div class="detail-title-wrap" style="margin-top: 0px;">
      <span class="detail-title">简介</span>
    </div>
    <div class="detail-content">
      <div class="e_contentMore">
        <div class="ea_content"><span id="des">暂无</span></div>
        <a class="ea_bt">...展开</a>
      </div>
    </div>
    <div id="glgs" class="detail-title-wrap">
      <span class="detail-title">关联公司</span><span class="relativeInfoCount detail-count">0</span><a target="_blank" class="detail-a pull-right allRrelative">查看全部></a>
    </div>
    <table class="ntable">
      <thead>
      <tr>
        <th class="tb" style="text-align: left;">名称</th>
        <th class="tb" style="width: 96px;">法定代表人</th>
      </tr>
      </thead>
      <tbody id="relativeInfoData">

      </tbody>
    </table>

    <div id="BossInfo" style="display: none;">
      <div class="detail-title-wrap">
        <span class="detail-title">基本信息</span>
      </div>
      <table class="ntable">
        <tbody>
        <tr>
          <td class="tb" style="width: 85px;">毕业院校</td>
          <td id="biye">-</td>
        </tr>
        <tr>
          <td class="tb">所学专业</td>
          <td id="zhuanye">-</td>
        </tr>
        <tr>
          <td class="tb">最高学历</td>
          <td id="xueli">-</td>
        </tr>
        <tr>
          <td class="tb">爱好</td>
          <td id="hobby">-</td>
        </tr>
        <tr>
          <td class="tb">工作单位</td>
          <td id="companyname">-</td>
        </tr>
        <tr>
          <td class="tb">职务</td>
          <td id="job">-</td>
        </tr>
        </tbody>
      </table>
      <div id="edu-wrap">
        <div class="detail-title-wrap">
          <span class="detail-title">教育经历</span>
        </div>
        <div id="edu"></div>
      </div>
      <div id="everjob-wrap">
        <div class="detail-title-wrap">
          <span class="detail-title">工作经历</span>
        </div>
        <div id="everjob">

        </div>
      </div>
      <div id="milestone-wrap">
        <div class="detail-title-wrap">
          <span class="detail-title">重要事件</span>
        </div>
        <table class="ntable">
          <tbody id="milestone">
          <tr>
            <td>暂无</td>
          </tr>
          </tbody>
        </table>
      </div>
      <div id="sayings-wrap">
        <div class="detail-title-wrap">
          <span class="detail-title">相关新闻</span>
        </div>
        <table class="ntable">
          <tbody id="sayings">
          <tr>
            <td>暂无</td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</script>
<script>
  /*详情滚动时显示标题*/
  function scrollTitleInit() {
    // 滚动显示标题
    var showIndex = 0;
    var pos = [];
    var showWraps = [];
    var wraps = document.getElementsByClassName("detail-title-wrap");
    for (var i = 0; i < wraps.length; i++) {
      var w = wraps[i];
      var obj = {name: '', y: 0}
      obj.name = $(w).find(".detail-title").text();
      obj.y = w.offsetTop;
      if (obj.y || i == 0) {
        pos.push(obj);
        showWraps.push(w);
      }
    }
    $("#NameBar").html($(showWraps[0]).html());
    $('#ScrollContent').scroll(function () {
      var top = $(this).scrollTop();
      top += 250;

      showIndex = 0;
      for (var i = 0; i < pos.length; i++) {
        if ((i + 1) < pos.length && top < pos[i + 1].y) {
          showIndex = i;
          break;
        }
        if ((i + 1) == pos.length) {
          showIndex = i;
        }
      }

      $("#NameBar").html($(showWraps[showIndex]).html());
      $("#NameBar").show();
    });
  }

  /**/
  function showDetail2(keyNo, tupuUrl, type) {
    $(".company-detail").hide();

    if (type && type == 'person') {
      var url = INDEX_URL + "boss_getDetail";
      $.ajax({
        url: url,
        type: 'GET',
        data: {"keyNo": keyNo},
        dataType: 'JSON',
        success: function (data) {
          if (!data.name) return;
          $("#ScrollContent").remove();
          // $("#ShowPerTupu").after($("#PerDeailTpl").html());

          $("#NameBar").after($("#PerDeailTpl").html());

          /*人物搜索里的查看图谱*/
          if (_currentKeyNo == keyNo || !data.boss_id) {
            $("#ShowPerTupu").attr('canshow', '0');
            $("#ShowPerTupu").hide();
          } else {
            $("#ShowPerTupu").attr('keyno', keyNo);
            $("#ShowPerTupu").attr('canshow', '1');
            $("#ShowPerTupu").show();
          }
          /*muhou3 muhou4里的查看图谱*/
          if (_currentKeyNo == keyNo) {
            $("#ShowPerTupuA").parent().hide();
          } else {
            $("#ShowPerTupuA").parent().show();
            $("#ShowPerTupuA").attr("href", "/company_muhou4?keyNo=" + keyNo + "&name=" + encodeURIComponent(data.name));
          }

          $("#BossInfo").hide();

          $('.allRrelative').attr('href', '/pl_' + keyNo);

          $('.ea_name').text(data.name ? data.name : '-');
          $('.ea_name').attr('href', '/pl_' + keyNo);


          $('.ea_defaultImg').text();
          $('.ea_defaultImg').hide();
          $('#face_oss').show();
          if (data.boss_id) {
            $('#face_oss').attr('src', data.face_oss);
          } else {
            $('#face_oss').attr('src', 'https://co-image.qichacha.com/PersonImage/' + keyNo + '.jpg');
          }

          $('#PerCom').text(data.companyname ? data.companyname : '-');
          $('#PerJob').text(data.job ? data.job : '-');
          if (data.companykey) {
            $('#PerCom').attr('href', '/firm_' + data.companykey);
          } else {
            $('#PerCom').attr('href', '');
          }
          $("#des").parent().parent().removeAttr('style');

          $("#des").text(data.des ? data.des : '暂无');
          /*简介没有时隐藏*/
          if (!data.des) {
            var desWrap = $("#des").parent().parent().parent();
            desWrap.siblings('.detail-title-wrap').eq(0).remove();
            desWrap.remove();
          }


          $(".relativeInfoCount").text(data.relativeInfoCount ? data.relativeInfoCount : '0');

          $("#relativeInfoData").html('');
          if (data.relativeInfoData && data.relativeInfoData.length) {
            var html = '';
            data.relativeInfoData.forEach(function (obj, index) {
              obj.Name = obj.Name ? obj.Name : '-';
              obj.OperName = obj.OperName ? obj.OperName : '-';
              if (index < 10) {
                html += '<tr><td>' +
                    '<a class="c_a" target="_blank" href="/firm_' + obj.KeyNo + '"><span>' + obj.Name + '</span></a></td>' +
                    '<td style="text-align: center;">' + obj.OperName + '</td></tr>'
              }
            })
            $("#relativeInfoData").html(html);
          }

          if (data.boss_id) { // 热门人物
            $("#BossInfo").show();
            $('#biye').text(data.biye ? data.biye : '-');
            $('#zhuanye').text(data.zhuanye ? data.zhuanye : '-');
            $('#xueli').text(data.xueli ? data.xueli : '-');
            $('#hobby').text(data.hobby ? data.hobby : '-');
            $('#companyname').text(data.companyname ? data.companyname : '-');
            $('#job').text(data.job ? data.job : '-');
            /*教育经历*/
            $('#edu').html('');
            var edus = '';
            if (data.edu) {
              edus = JSON.parse(data.edu);
            }
            if (data.edu && edus && edus.length) {
              var html = '';
              edus.forEach(function (obj) {
                if (!obj.TimeQuantum) {
                  obj.TimeQuantum = '-'
                }
                if (!obj.Diplomas) {
                  obj.Diplomas = '-'
                }
                if (!obj.University) {
                  obj.University = '-'
                }
                if (!obj.Major) {
                  obj.Major = '-'
                }
                html += '<table class="ntable"><tbody>' +
                    '<tr><td class="tb" style="width: 85px;">教育时间</td><td >' + obj.TimeQuantum + '</td></tr>' +
                    '<tr><td class="tb">学历</td><td>' + obj.Diplomas + '</td></tr>' +
                    '<tr><td class="tb">毕业院校</td><td>' + obj.University + '</td></tr>' +
                    '<tr><td class="tb">所学专业</td><td>' + obj.Major + '</td></tr>' +
                    '</tbody></table>';
              })
              $('#edu').html(html);
              $('#edu-wrap').show();
            } else {
              $('#edu-wrap').hide();
            }
            /*工作经历*/
            $('#everjob').html('');
            var jobs = '';
            if (data.everjob) {
              jobs = JSON.parse(data.everjob);
            }
            if (data.everjob && jobs && jobs.length) {
              var html = '';
              jobs.forEach(function (obj) {
                if (!obj.TimeQuantum) {
                  obj.TimeQuantum = '-'
                }
                if (!obj.Job) {
                  obj.Job = '-'
                }
                if (!obj.CompanyName) {
                  obj.CompanyName = '-'
                }
                if (!obj.Abstract) {
                  obj.Abstract = '-'
                }
                html += '<table class="ntable"><tbody>' +
                    '<tr><td class="tb" style="width: 85px;">工作时间</td><td >' + obj.TimeQuantum + '</td></tr>' +
                    '<tr><td class="tb">职位</td><td>' + obj.Job + '</td></tr>' +
                    '<tr><td class="tb">工作单位</td><td>' + obj.CompanyName + '</td></tr>' +
                    '<tr><td class="tb">描述</td><td>' +
                    '<div class="e_contentMore">' +
                    '<div class="ea_content">' + obj.Abstract + '</div>' +
                    '<a class="ea_bt">...展开</a>' +
                    '</div>' +
                    '</td></tr>' +
                    '</tbody></table>';
              })
              $('#everjob').html(html);
              $('#everjob-wrap').show();
            } else {
              $('#everjob-wrap').hide();
            }
            /*重要事件*/
            $('#milestone').html('');
            var milestones = '';
            if (data.milestone) {
              milestones = JSON.parse(data.milestone);
            }
            if (data.milestone && milestones && milestones.length) {
              var html = '';
              milestones.forEach(function (obj) {
                if (!obj.Milestone) {
                  obj.Milestone = '-'
                }
                html += '<tr><td><div class="e_contentMore">' +
                    '<div class="ea_content">' + obj.Milestone + '</div>' +
                    '<a class="ea_bt">...展开</a>' +
                    '</div></td></tr>';
              })
              $('#milestone').html(html);
              $('#milestone-wrap').show();
            } else {
              $('#milestone-wrap').hide();
            }
            /*相关新闻*/
            $('#sayings').html('');
            var sayings = '';
            if (data.sayings) {
              sayings = JSON.parse(data.sayings);
            }
            if (data.sayings && sayings && sayings.length) {
              var html = '';
              sayings.forEach(function (obj) {
                if (!obj.TimeQuantum) {
                  obj.TimeQuantum = '-'
                }
                if (!obj.Job) {
                  obj.Job = '-'
                }
                if (!obj.CompanyName) {
                  obj.CompanyName = '-'
                }
                if (!obj.Abstract) {
                  obj.Abstract = '-'
                }
                obj.Link = obj.Link.replace('http://', '');
                obj.Link = obj.Link.replace('https://', '');
                html += '<tr><td><a target="_blank" href="http://' + obj.Link + '">' + obj.Title + '</a></td></tr>';
              })
              $('#sayings').html(html);
              $('#sayings-wrap').show();
            } else {
              $('#sayings-wrap').hide();
            }
          }

          $("#person-detail").fadeIn();

          /*e_contentMore元素初始化*/
          $(".e_contentMore").each(function () {
            var wrap = $(this);
            var content = wrap.find(".ea_content");
            var bt = wrap.find(".ea_bt");

            var wrapHeight = wrap.height();
            var contentHeight = content.height();
            if (contentHeight > wrapHeight) {
              bt.show();
            } else {
              bt.hide();
            }
            bt.click(function () {
              if (bt.text() == "收起") {
                wrap.css({maxHeight: wrapHeight});
                bt.text("...展开");
              } else {
                wrap.css({maxHeight: (contentHeight + 20), height: (contentHeight + 20)});
                bt.text("收起");
              }

              scrollTitleInit();
            });
          })

          /*样式处理,bug #2191-1*/
          if ($("#BossInfo").is(':hidden')) {
            $("#glgs").siblings('.ntable').addClass('marginNone');
          } else {
            $("#glgs").siblings('.ntable').removeClass('marginNone');
          }

          /*$('#ScrollContent').slimScroll({
              wheelStep: 1
          });*/

          scrollTitleInit();

        },
        error: function (data) {
          console.log(data);
        }
      });
    } else {
      var url = INDEX_URL + "more_findRelationsDetail";
      $.ajax({
        url: url,
        type: 'GET',
        data: {"keyNo": keyNo},
        dataType: 'JSON',
        success: function (data) {
          if (data.Status != 200) {
            return;
          }
          var companyDetail = $('#company-detail');
          companyDetail.find('.mao-img').attr("src", data.Result.ImageUrl);
          companyDetail.find('.mao-company-name').text(data.Result.Name);
          companyDetail.find('.mao-company-status').text(data.Result.ShortStatus || '-');
          if (data.Result.Oper && data.Result.Oper.Name) {
            if (data.Result.Oper.KeyNo) {
              if (data.Result.Oper.KeyNo[0] == 'p') {
                companyDetail.find('.mao-oper').html('<a target="_blank" href="/pl_' + data.Result.Oper.KeyNo + '.html">' + data.Result.Oper.Name + '</a>');
              } else {
                companyDetail.find('.mao-oper').html('<a target="_blank" href="/firm_' + data.Result.Oper.KeyNo + '.shtml">' + data.Result.Oper.Name + '</a>');
              }
            } else {
              companyDetail.find('.mao-oper').html('<a target="_blank" href="/people?name=' + encodeURI(data.Result.Oper.Name) + '&keyno=' + keyNo + '">' + data.Result.Oper.Name + '</a>');
            }
            if (data.Result.Oper.OperType == 1) {
              companyDetail.find('.mao-oper').prev().text('法定代表人：');
            } else if (data.Result.Oper.OperType == 2) {
              companyDetail.find('.mao-oper').prev().text('执行事务合伙人：');
            } else if (data.Result.Oper.OperType == 3) {
              companyDetail.find('.mao-oper').prev().text('负责人：');
            } else if (data.Result.Oper.OperType == 4) {
              companyDetail.find('.mao-oper').prev().text('经营者：');
            } else if (data.Result.Oper.OperType == 5) {
              companyDetail.find('.mao-oper').prev().text('投资人：');
            } else if (data.Result.Oper.OperType == 6) {
              companyDetail.find('.mao-oper').prev().text('董事长：');
            } else if (data.Result.Oper.OperType == 7) {
              companyDetail.find('.mao-oper').prev().text('理事长：');
            }
          } else {
            companyDetail.find('.mao-oper').text('-');
          }

          companyDetail.find('.mao-ziben').text(data.Result.RegistCapi || '-');
          companyDetail.find('.mao-date').text((data.Result.StartDate || ''));
          companyDetail.find('.mao-company-name').attr("href", "firm_" + keyNo + ".shtml");
          if (!tupuUrl) {
            tupuUrl = 'company_relation';
          }
          companyDetail.find('.mao-tupu-link').attr("href", tupuUrl + "?keyNo=" + keyNo + "&name=" + encodeURIComponent(data.Result.Name));
          //companyDetail.find('.mao-tupu-link').attr("onclick","zhugeTrack(\'图谱页面-侧边栏企业信息-查看图谱\')");
          companyDetail.find('.close').click(function () {
            companyDetail.fadeOut();
          });

          if (_currentKeyNo == keyNo) {
            $(".mao-tupu-link").parent().hide();
          } else {
            $(".mao-tupu-link").parent().show();
          }

          var noData = '<div class="mao-noresult"> <p ><img src="/material/theme/chacha/cms/v2/images/nodata.png"></p>暂无信息</div>';

          //股东
          if (data.Result.Partners && data.Result.Partners.length > 0) {
            var html = '<table class="ntable">';
            html += "<thead><tr><th style='text-align: left'>名称</th><th>类型</th></tr></thead>";
            for (var i = 0; i < data.Result.Partners.length; i++) {
              html += "<tr>";
              if (data.Result.Partners[i].KeyNo) {
                if (data.Result.Partners[i].KeyNo[0] == 'p') {
                  html += '<td><a onclick="" target="_blank" href="/pl_' + data.Result.Partners[i].KeyNo + '.html">' + data.Result.Partners[i].StockName + '</a></td>';
                } else {
                  html += '<td><a onclick="" target="_blank" href="/firm_' + data.Result.Partners[i].KeyNo + '.shtml">' + data.Result.Partners[i].StockName + '</a></td>';
                }
              } else {
                if (data.Result.Partners[i].StockName.length > 3) {
                  html += "<td>" + data.Result.Partners[i].StockName + "</td>";
                } else {
                  html += '<td><a onclick="" target="_blank" href="/people?name=' + encodeURI(data.Result.Partners[i].StockName) + '&keyno=' + keyNo + '">' + data.Result.Partners[i].StockName + '</a></td>';
                }
              }
              html += "<td>" + (data.Result.Partners[i].StockType || "-") + "</td>";
              html += "</tr>";
            }
            html += '</table>'

            companyDetail.find('.gudong-list').html(html);


          } else {
            companyDetail.find('.gudong-list').html(noData);
          }

          //投资
          if (data.Result.touziList && data.Result.touziList.length > 0) {

            var html = '<table class="ntable">';
            html += "<thead><tr><th  style='text-align: left'>名称</th></tr></thead>";
            for (var i = 0; i < data.Result.touziList.length; i++) {
              html += "<tr>";
              html += "<td><a onclick='' href='/firm_" + data.Result.touziList[i].KeyNo + ".shtml' target='_blank'>" + data.Result.touziList[i].Name + "</a></td>";
              html += "</tr>";
            }
            html += '</table>';
            companyDetail.find('.touzi-list').html(html);
          } else {
            companyDetail.find('.touzi-list').html(noData);
          }

          //成员
          if (data.Result.Employees && data.Result.Employees.length > 0) {
            var html = '<table class="ntable">';
            html += "<thead><tr><th  style='text-align: left'>名称</th><th>类型</th></tr></thead>";
            for (var i = 0; i < data.Result.Employees.length; i++) {
              html += "<tr>";
              if (data.Result.Employees[i].KeyNo && data.Result.Employees[i].KeyNo[0] == 'p') {
                html += '<td><a onclick="" target="_blank" href="/pl_' + data.Result.Employees[i].KeyNo + '.html">' + data.Result.Employees[i].Name + '</a></td>';
              } else {
                html += '<td><a onclick="" target="_blank" href="/people?name=' + encodeURI(data.Result.Employees[i].Name) + '&keyno=' + keyNo + '">' + data.Result.Employees[i].Name + '</a></td>';
              }
              html += "<td>" + (data.Result.Employees[i].Job || "-") + "</td>";
              html += "</tr>";
            }
            html += '</table>';
            companyDetail.find('.member-list').html(html);

          } else {
            companyDetail.find('.member-list').html(noData);
          }

          $("#company-detail").fadeIn();
          companyDetail.find('.mao-tab-content').slimScroll({
            wheelStep: 1
          });
        },
        error: function (data) {
          console.log(data);
        }
      });
    }
  }


  /*ie兼容*/
  var isIE = (!!window.ActiveXObject || "ActiveXObject" in window);
  if (isIE) {
    $("#NameBar").css({'width': '270px'});
  }
</script>
<style type="text/css">
  #vipModal .modal-dialog {
    width: 780px;
  }

  #vipModal .modal-content {
    padding-bottom: 25px;
    border-radius: 0px;
    text-align: center;

  }

  #vipModal .close {
    color: #FFF;
    font-size: 40px;
    opacity: 0.8;
    font-weight: normal;
    position: absolute;
    right: 10px;
  }

  .step2 {
    display: none;
  }
</style>
<link type="text/css" href="/material/theme/chacha/cms/v2/css/vip-modal.css?version=1561053264" rel="stylesheet"/>
<div class="modal fade" id="vipModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog nmodal">
    <div class="modal-content">
      <div class="vip-top">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">x</span></button>
        <div class="vip-title"><h2 class="title">立即成为VIP</h2>
          <h3 class="sub-title"><span>更多特权 超值服务</span><a href="/vip">全部特权></a></h3></div>
        <div class="vip-buy-panel">
          <div class="vip-year-list clearfix">
            <div data-id="17" data-year="3" data-price="720" class="vip-kuang vip-year active">
              <div class="price"><span>720元</span> <span class="vip-pay">/</span>
                3年
              </div>
              <div class="origin-price">原价：2160元</div>
              <div class="vip-rec"></div>
            </div>
            <div data-id="7" data-year="2" data-price="540" class="vip-kuang vip-year">
              <div class="price"><span>540元</span> <span class="vip-pay">/</span>
                2年
              </div>
              <div class="origin-price">原价：1440元</div>
            </div>
            <div data-id="6" data-year="1" data-price="360" class="vip-kuang vip-year">
              <div class="price"><span>360元</span> <span class="vip-pay">/</span>
                1年
              </div>
              <div class="origin-price">原价：720元</div>
            </div>
          </div>
          <div class="step1 m-t-md"><a onclick="modalJumpVip()" class="vip-btn">立即开通</a>
            <div class="vip-publicity">支付后可开发票</div>
          </div>
          <form id="pay-form" class="vip-pay-info step2" target="aliPayFrame" role="form" method="post" action="/order_pay">
            <div class="clearfix"><span class="pre">购买账号：</span><span class="after">18012920403</span></div>
            <div class="clearfix coupon-drop"><span class="pre">优惠券：</span><span data-toggle="dropdown" class="after drop"><span id="couponText">暂无优惠券</span><span
                    class="caret"></span></span>
              <ul class="dropdown-menu" id="couponList">
                <li><span class="coupon-type">暂无优惠券</span></li>
              </ul>
            </div>
            <div class="clearfix  m-b-xs"><span class="pre">实付金额：</span><span class="after vip-pay" id="payYear">¥720.00</span></div>
            <input type="hidden" name="order_type" value="2"/> <input type="hidden" name="goods_id" value="17"/> <input type="hidden" name="pay_type" value="2"/> <input
                  type="hidden" name="coupon_code" value=""/> <input type="submit" class="btn btn-primary packages-btn" value="立即支付" style="display: none"/></form>
        </div>
      </div>
      <div class="vip-pay-container clearfix">
        <div class="step1"><img class="demo-img" src="/material/theme/chacha/cms/v2/images/vip/fxsm.png"/> <a class="vip-demo-link" href=""></a></div>
        <div class="step2">
          <div class="vip-payj-left">
            <div onclick="checkPay(2)" class="pay-type pay-type-wx active"></div>
            <div onclick="checkPay(1)" class="pay-type pay-type-ali m-t-xs"></div>
            <div class="m-t-lg"><p>1.完成支付后可在我的-我的发票中申请发票</p>
              <p>2.VIP会员自支付完成之时起5分钟内生效</p></div>
          </div>
          <div class="vip-payj-qrcode">
            <div class="wx_pay_box">
              <div id="wx_pay_img" class="wx_pay_img"></div>
              <img class="pay-load" src="/material/theme/chacha/cms/v2/images/preloader.gif"></div>
            <div class="ali_pay_box" loading-img="/material/theme/chacha/cms/v2/images/preloader.gif"><img class="pay-load"
                                                                                                           src="/material/theme/chacha/cms/v2/images/preloader.gif"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript" src="/material/theme/chacha/cms/v2/js/pay.js?time=1561053264"></script>
<script type="text/javascript">
  var vipModalTitle;
  var userid = 'dd4e30f52043d9572827d3d8413ae323';

  function showVipModal(title, subTitle, img, linkName, linkUrl, isStep2) {

    if (!userid) {
      getCaptcha();
      $('#loginModal').modal('show');
      return;
    }

    $("#vipModal .step1").show();
    $("#vipModal .step2").hide();

    if (title) {
      $('#vipModal .vip-title .title').text(title);
      //vipModalTitle = title;
    }
    if (subTitle) {
      $('#vipModal .vip-title .sub-title span').text(subTitle);
    }
    if (img) {
      if (title == '雷达监控') {
        var imgUrl = "/material/theme/chacha/cms/v2/images/vip/ldjk.png";
        $("#vipModal .demo-img").attr("src", imgUrl);
      } else {
        var imgUrl = "/material/theme/chacha/cms/v2/images/vip/" + img + ".png";
        $("#vipModal .demo-img").attr("src", imgUrl);
      }
    } else {
      var imgUrl = "/material/theme/chacha/cms/v2/images/vip/default.png";
      $("#vipModal .demo-img").attr("src", imgUrl);
    }
    if (linkName && linkUrl) {
      $("#vipModal .vip-demo-link").show();
      $("#vipModal .vip-demo-link").text(linkName + '>');
      $("#vipModal .vip-demo-link").attr('href', linkUrl);
    } else {
      $("#vipModal .vip-demo-link").hide();
    }

    /*if(isStep2){
        $("#vipModal .step1").hide();
        $("#vipModal .step2").show();
        strartBuy();
    }*/

    $('#vipModal').modal('show');

    // 嵌入的关闭
    $(".vip-insert-wrap .step1").show();
    $(".vip-insert-wrap .step2").hide();
  }

  $('#vipModal').on('hide.bs.modal', function () {
    clearPay();
    isPayShow = false;
  })

  function modalJumpVip() {
    isPayShow = true;

    strartBuy();

    $("#vipModal .step1").hide();
    $("#vipModal .step2").show();

    /*yaojie old
    location.href = INDEX_URL+'/vip?goods_id='+$("input[name='goods_id']").val();
    if(vipModalTitle){
        //zhugeTrack(vipModalTitle.split(' ')[0]+'-开通VIP');
    }else{
        //zhugeTrack('VIP弹框-开通VIP');
    }*/
  }

  var isPayShow = false;
  var wxOrderStatus = 0;
  var wxOrderCode = '';
  var wxpayLoad = false;
  var alipayLoad = false;
  var cPayType = 2;
  var isModalShow = true;
  var cGoods_id = "17";
  var cYear = "3";
  var cPrice = "720";

  $('#vipModal .vip-year-list .vip-kuang').on('click', function () {
    changeYear($(this).attr('data-id'), $(this).attr('data-year'), $(this).attr('data-price'), this);
    var couponCode = $("#vipModal input[name='coupon_code']").val();
    if (couponCode == '') {
      //checkPay(cPayType);
    }
  });


  var siModel = null;

  function strartBuy() {
    if (typeof siModel != 'undefined' && siModel) {
      clearInterval(siModel);
      siModel = null;
    }
    if (typeof siInsert != 'undefined' && siInsert) {
      clearInterval(siInsert);
      siInsert = null;
    }
    siModel = setInterval(function () {
      getWxPayStatus();
    }, 3000);
    //checkPay(cPayType);
    setTimeout(function () {
      getcouponlist(cGoods_id);
    }, 300);
  }
</script>
</body>
</html>
